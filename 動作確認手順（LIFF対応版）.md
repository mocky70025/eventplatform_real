# 動作確認手順（LIFF対応版）

## 概要

LIFF環境とWeb環境での動作確認を行います。LIFF環境ではメールアドレス認証は非表示になり、LINE認証のみが利用可能です。

---

## 準備

### 1. テスト用アカウントの準備

#### LINE Login用
- LINE Developers Consoleでテストユーザーとして追加済みのLINEアカウント
- または、開発ステータスのチャネルを使用する場合は、開発者ロールを持つLINEアカウント

#### メールアドレス・パスワード用（Web環境のみ）
- 実際にメールを受信できるメールアドレスを複数用意
  - 新規登録用：`test-exhibitor-new@example.com`、`test-organizer-new@example.com`
  - 既存ユーザー用：`test-exhibitor-existing@example.com`、`test-organizer-existing@example.com`

### 2. ブラウザの準備
- 通常モードとシークレットモード（プライベートモード）を使用
- 複数のブラウザ（Chrome、Safari、Firefox）で確認（推奨）

### 3. アプリケーションURL
- 出店者アプリ（Web）：`https://tomorrow-event-platform-store.vercel.app`
- 主催者アプリ（Web）：`https://tomorrow-event-platform-organizer.vercel.app`
- 出店者アプリ（LIFF）：LINE Developers Consoleで取得したLIFF URL
- 主催者アプリ（LIFF）：LINE Developers Consoleで取得したLIFF URL

### 4. データベースの準備
- 各パターンの確認前に、必要に応じてテストデータを削除
- `テストデータ削除スクリプト.sql` または `テストデータ削除スクリプト（条件付き）.sql` を使用

---

## 出店者アプリ（store）の動作確認

### Web環境での確認

#### パターン1: LINE Login（新規登録）

**事前準備：**
- データベースから該当するLINEアカウントのデータを削除（既に登録済みの場合）

**手順：**
1. `https://tomorrow-event-platform-store.vercel.app` を開く
2. ✅ 「新規登録」と「ログイン」のボタンが表示される
3. ✅ 「新規登録」をクリック
4. ✅ 「LINEで新規登録」と「メールアドレスで新規登録」のボタンが表示される
5. ✅ 「LINEで新規登録」をクリック
6. ✅ LINE Loginの認証画面にリダイレクトされる
7. ✅ LINEアカウントでログイン
8. ✅ アプリに戻る（コールバック）
9. ✅ 登録フォーム（3ステップ）が表示される
10. ✅ フォームに入力・送信できる
11. ✅ 「登録が完了しました」画面が表示される

**確認ポイント：**
- [ ] Web環境では、LINE認証とメールアドレス認証の両方が表示される
- [ ] LINE Loginの認証フローが正常に動作する
- [ ] 登録フォームに入力・送信できる

---

#### パターン2: LINE Login（既存ユーザー）

**事前準備：**
- パターン1で登録済みのLINEアカウントを使用

**手順：**
1. `https://tomorrow-event-platform-store.vercel.app` を開く
2. ✅ 「ログイン」をクリック
3. ✅ 「LINEでログイン」と「メールアドレスでログイン」のボタンが表示される
4. ✅ 「LINEでログイン」をクリック
5. ✅ LINE Loginの認証画面でログイン
6. ✅ 登録フォームではなく、ホーム画面（イベント一覧）が表示される

**確認ポイント：**
- [ ] 既存ユーザーは登録フォームが表示されない
- [ ] ホーム画面（イベント一覧）が表示される

---

#### パターン3: メールアドレス・パスワード（新規登録）

**事前準備：**
- データベースから該当するメールアドレス（`test-exhibitor-new@example.com`）のデータを削除

**手順：**
1. `https://tomorrow-event-platform-store.vercel.app` を開く
2. ✅ 「新規登録」をクリック
3. ✅ 「メールアドレスで新規登録」をクリック
4. ✅ メールアドレスとパスワードを入力
5. ✅ 「登録する」をクリック
6. ✅ メール確認待ち画面が表示される
7. ✅ 確認メールが届く
8. ✅ メール内のリンクをクリック
9. ✅ メール確認が完了し、登録フォームが表示される
10. ✅ フォームに入力・送信できる

**確認ポイント：**
- [ ] Web環境では、メールアドレス認証が利用できる
- [ ] メール確認待ち画面が表示される
- [ ] 確認メールが届く
- [ ] メール確認後、登録フォームが表示される

---

#### パターン4: メールアドレス・パスワード（既存ユーザー）

**事前準備：**
- パターン3で登録済みのメールアドレス・パスワードを使用

**手順：**
1. `https://tomorrow-event-platform-store.vercel.app` を開く
2. ✅ 「ログイン」をクリック
3. ✅ 「メールアドレスでログイン」をクリック
4. ✅ メールアドレスとパスワードを入力
5. ✅ 「ログイン」をクリック
6. ✅ ホーム画面（イベント一覧）が表示される

**確認ポイント：**
- [ ] 既存ユーザーは登録フォームが表示されない
- [ ] ホーム画面（イベント一覧）が表示される

---

### LIFF環境での確認

#### パターン5: LINE Login（新規登録）- LIFF環境

**事前準備：**
- LINE Developers ConsoleでLIFFアプリを作成
- LIFF URLを取得
- データベースから該当するLINEアカウントのデータを削除（既に登録済みの場合）

**手順：**
1. LINEアプリでLIFF URLを開く
2. ✅ 「新規登録」と「ログイン」のボタンが表示される
3. ✅ 「新規登録」をクリック
4. ✅ **「LINEで新規登録」ボタンのみが表示される**（メールアドレスで新規登録は表示されない）
5. ✅ 「LINEで新規登録」をクリック
6. ✅ LINE Loginの認証画面にリダイレクトされる（外部ブラウザで開く場合がある）
7. ✅ LINEアカウントでログイン
8. ✅ アプリに戻る（コールバック）
9. ✅ 登録フォーム（3ステップ）が表示される
10. ✅ フォームに入力・送信できる

**確認ポイント：**
- [ ] LIFF環境では、メールアドレス認証のボタンが表示されない
- [ ] LINE認証のみが利用できる
- [ ] LINE Loginの認証フローが正常に動作する
- [ ] 登録フォームに入力・送信できる

---

#### パターン6: LINE Login（既存ユーザー）- LIFF環境

**事前準備：**
- パターン5で登録済みのLINEアカウントを使用

**手順：**
1. LINEアプリでLIFF URLを開く
2. ✅ 「ログイン」をクリック
3. ✅ **「LINEでログイン」ボタンのみが表示される**（メールアドレスでログインは表示されない）
4. ✅ 「LINEでログイン」をクリック
5. ✅ LINE Loginの認証画面でログイン
6. ✅ 登録フォームではなく、ホーム画面（イベント一覧）が表示される

**確認ポイント：**
- [ ] LIFF環境では、メールアドレス認証のボタンが表示されない
- [ ] 既存ユーザーは登録フォームが表示されない
- [ ] ホーム画面（イベント一覧）が表示される

---

## 主催者アプリ（organizer）の動作確認

### Web環境での確認

#### パターン7: LINE Login（新規登録）

**事前準備：**
- データベースから該当するLINEアカウントのデータを削除（既に登録済みの場合）

**手順：**
1. `https://tomorrow-event-platform-organizer.vercel.app` を開く
2. ✅ 「新規登録」と「ログイン」のボタンが表示される
3. ✅ 「新規登録」をクリック
4. ✅ 「LINEで新規登録」と「メールアドレスで新規登録」のボタンが表示される
5. ✅ 「LINEで新規登録」をクリック
6. ✅ LINE Loginの認証画面にリダイレクトされる
7. ✅ LINEアカウントでログイン
8. ✅ アプリに戻る（コールバック）
9. ✅ 登録フォームが表示される
10. ✅ フォームに入力・送信できる

**確認ポイント：**
- [ ] Web環境では、LINE認証とメールアドレス認証の両方が表示される
- [ ] LINE Loginの認証フローが正常に動作する
- [ ] 登録フォームに入力・送信できる

---

#### パターン8: LINE Login（既存ユーザー）

**事前準備：**
- パターン7で登録済みのLINEアカウントを使用

**手順：**
1. `https://tomorrow-event-platform-organizer.vercel.app` を開く
2. ✅ 「ログイン」をクリック
3. ✅ 「LINEでログイン」と「メールアドレスでログイン」のボタンが表示される
4. ✅ 「LINEでログイン」をクリック
5. ✅ LINE Loginの認証画面でログイン
6. ✅ 登録フォームではなく、ホーム画面（イベント管理）が表示される

**確認ポイント：**
- [ ] 既存ユーザーは登録フォームが表示されない
- [ ] ホーム画面（イベント管理）が表示される

---

#### パターン9: メールアドレス・パスワード（新規登録）

**事前準備：**
- データベースから該当するメールアドレス（`test-organizer-new@example.com`）のデータを削除

**手順：**
1. `https://tomorrow-event-platform-organizer.vercel.app` を開く
2. ✅ 「新規登録」をクリック
3. ✅ 「メールアドレスで新規登録」をクリック
4. ✅ メールアドレスとパスワードを入力
5. ✅ 「登録する」をクリック
6. ✅ メール確認待ち画面が表示される
7. ✅ 確認メールが届く
8. ✅ メール内のリンクをクリック
9. ✅ メール確認が完了し、登録フォームが表示される
10. ✅ フォームに入力・送信できる

**確認ポイント：**
- [ ] Web環境では、メールアドレス認証が利用できる
- [ ] メール確認待ち画面が表示される
- [ ] 確認メールが届く
- [ ] メール確認後、登録フォームが表示される

---

#### パターン10: メールアドレス・パスワード（既存ユーザー）

**事前準備：**
- パターン9で登録済みのメールアドレス・パスワードを使用

**手順：**
1. `https://tomorrow-event-platform-organizer.vercel.app` を開く
2. ✅ 「ログイン」をクリック
3. ✅ 「メールアドレスでログイン」をクリック
4. ✅ メールアドレスとパスワードを入力
5. ✅ 「ログイン」をクリック
6. ✅ ホーム画面（イベント管理）が表示される

**確認ポイント：**
- [ ] 既存ユーザーは登録フォームが表示されない
- [ ] ホーム画面（イベント管理）が表示される

---

### LIFF環境での確認

#### パターン11: LINE Login（新規登録）- LIFF環境

**事前準備：**
- LINE Developers Consoleで主催者用のLIFFアプリを作成
- LIFF URLを取得
- データベースから該当するLINEアカウントのデータを削除（既に登録済みの場合）

**手順：**
1. LINEアプリでLIFF URLを開く
2. ✅ 「新規登録」と「ログイン」のボタンが表示される
3. ✅ 「新規登録」をクリック
4. ✅ **「LINEで新規登録」ボタンのみが表示される**（メールアドレスで新規登録は表示されない）
5. ✅ 「LINEで新規登録」をクリック
6. ✅ LINE Loginの認証画面にリダイレクトされる（外部ブラウザで開く場合がある）
7. ✅ LINEアカウントでログイン
8. ✅ アプリに戻る（コールバック）
9. ✅ 登録フォームが表示される
10. ✅ フォームに入力・送信できる

**確認ポイント：**
- [ ] LIFF環境では、メールアドレス認証のボタンが表示されない
- [ ] LINE認証のみが利用できる
- [ ] LINE Loginの認証フローが正常に動作する
- [ ] 登録フォームに入力・送信できる

---

#### パターン12: LINE Login（既存ユーザー）- LIFF環境

**事前準備：**
- パターン11で登録済みのLINEアカウントを使用

**手順：**
1. LINEアプリでLIFF URLを開く
2. ✅ 「ログイン」をクリック
3. ✅ **「LINEでログイン」ボタンのみが表示される**（メールアドレスでログインは表示されない）
4. ✅ 「LINEでログイン」をクリック
5. ✅ LINE Loginの認証画面でログイン
6. ✅ 登録フォームではなく、ホーム画面（イベント管理）が表示される

**確認ポイント：**
- [ ] LIFF環境では、メールアドレス認証のボタンが表示されない
- [ ] 既存ユーザーは登録フォームが表示されない
- [ ] ホーム画面（イベント管理）が表示される

---

## 動作確認チェックリスト

### 出店者アプリ（store）

#### Web環境
- [ ] パターン1: LINE Login（新規登録）
- [ ] パターン2: LINE Login（既存ユーザー）
- [ ] パターン3: メールアドレス・パスワード（新規登録）
- [ ] パターン4: メールアドレス・パスワード（既存ユーザー）

#### LIFF環境
- [ ] パターン5: LINE Login（新規登録）- LIFF環境
- [ ] パターン6: LINE Login（既存ユーザー）- LIFF環境
- [ ] **重要**: LIFF環境では、メールアドレス認証のボタンが表示されないことを確認

### 主催者アプリ（organizer）

#### Web環境
- [ ] パターン7: LINE Login（新規登録）
- [ ] パターン8: LINE Login（既存ユーザー）
- [ ] パターン9: メールアドレス・パスワード（新規登録）
- [ ] パターン10: メールアドレス・パスワード（既存ユーザー）

#### LIFF環境
- [ ] パターン11: LINE Login（新規登録）- LIFF環境
- [ ] パターン12: LINE Login（既存ユーザー）- LIFF環境
- [ ] **重要**: LIFF環境では、メールアドレス認証のボタンが表示されないことを確認

---

## 重要な確認ポイント

### LIFF環境での確認
- ✅ **メールアドレス認証のボタンが表示されない**
- ✅ **LINE認証のみが利用できる**
- ✅ **LINE Loginの認証フローが正常に動作する**

### Web環境での確認
- ✅ **LINE認証とメールアドレス認証の両方が表示される**
- ✅ **両方の認証方法が正常に動作する**

---

## トラブルシューティング

### LIFF環境でメールアドレス認証のボタンが表示される場合

1. **ブラウザのコンソールで確認**
   - `[Home] Environment: LIFF` が表示されるか確認
   - `isLiffEnvironment()` 関数が正しく動作しているか確認

2. **URLを確認**
   - LIFF URLが正しく設定されているか確認
   - `liff.line.me` がURLに含まれているか確認

3. **キャッシュをクリア**
   - ブラウザのキャッシュをクリア
   - または、シークレットモードで確認

### Web環境でメールアドレス認証のボタンが表示されない場合

1. **ブラウザのコンソールで確認**
   - `[Home] Environment: Web` が表示されるか確認
   - エラーメッセージがないか確認

2. **環境変数を確認**
   - `NEXT_PUBLIC_APP_URL` が正しく設定されているか確認

---

## 完了条件

全てのパターンについて以下が確認できれば完了です：

1. ✅ Web環境では、LINE認証とメールアドレス認証の両方が利用できる
2. ✅ LIFF環境では、LINE認証のみが利用できる（メールアドレス認証は表示されない）
3. ✅ 新規登録が正常に完了する
4. ✅ 既存ユーザーのログインが正常に動作する
5. ✅ メール確認が正常に動作する（Web環境のみ）

