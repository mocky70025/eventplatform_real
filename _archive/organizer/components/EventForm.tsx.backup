'use client'

import { useState, useEffect, useRef, useCallback, useMemo } from 'react'
import { supabase, type Event, type Organizer } from '@/lib/supabase'
import ImageUpload from './ImageUpload'
import ProgressBar from './ProgressBar'

interface EventFormProps {
  organizer: Organizer
  onEventCreated: (event: Event) => void
  onCancel: () => void
  initialEvent?: Partial<Event> // 編集時に事前入力
}

interface EventSchedule {
  id: string // 一意のID（UUID）
  date: string // YYYY-MM-DD
  start_time: string // HH:mm
  end_time: string // HH:mm
}

interface EventFormState {
  event_name: string
  event_name_furigana: string
  genre: string
  is_shizuoka_vocational_assoc_related: boolean
  opt_out_newspaper_publication: boolean
  schedules: EventSchedule[] // 複数の日程
  event_display_period: string
  event_period_notes: string
  // 後方互換性のためのフィールド（保存時に自動生成）
  event_start_date: string
  event_end_date: string
  event_time: string
  application_start_date: string
  application_end_date: string
  application_display_period: string
  application_notes: string
  ticket_release_start_date: string
  ticket_sales_location: string
  lead_text: string
  event_description: string
  event_introduction_text: string
  venue_name: string
  venue_postal_code: string
  venue_city: string
  venue_town: string
  venue_address: string
  venue_latitude: string
  venue_longitude: string
  homepage_url: string
  related_page_url: string
  contact_name: string
  contact_phone: string
  contact_email: string
  parking_info: string
  fee_info: string
  organizer_info: string
}

interface EventImageState {
  main: string
  additional1: string
  additional2: string
  additional3: string
  additional4: string
}

interface EventFormDraftPayload {
  formData: EventFormState
  imageUrls: EventImageState
}

const SAVE_DEBOUNCE_MS = 800
const EVENT_FORM_DRAFT_TYPE = 'organizer_event_form'

const EVENT_FORM_EMPTY_STATE: EventFormState = {
  event_name: '',
  event_name_furigana: '',
  genre: '',
  is_shizuoka_vocational_assoc_related: false,
  opt_out_newspaper_publication: false,
  schedules: [{ id: crypto.randomUUID(), date: '', start_time: '', end_time: '' }], // 初期状態で1つの日程を表示
  event_display_period: '',
  event_period_notes: '',
  event_start_date: '',
  event_end_date: '',
  event_time: '',
  application_start_date: '',
  application_end_date: '',
  application_display_period: '',
  application_notes: '',
  ticket_release_start_date: '',
  ticket_sales_location: '',
  lead_text: '',
  event_description: '',
  event_introduction_text: '',
  venue_name: '',
  venue_postal_code: '',
  venue_city: '',
  venue_town: '',
  venue_address: '',
  venue_latitude: '',
  venue_longitude: '',
  homepage_url: '',
  related_page_url: '',
  contact_name: '',
  contact_phone: '',
  contact_email: '',
  parking_info: '',
  fee_info: '',
  organizer_info: '',
}

const EVENT_IMAGE_INITIAL: EventImageState = {
  main: '',
  additional1: '',
  additional2: '',
  additional3: '',
  additional4: '',
}

const hasEventDraftContent = (payload: EventFormDraftPayload): boolean => {
  const hasFormValue = Object.values(payload.formData).some((value) => {
    if (typeof value === 'string') return value.trim() !== ''
    if (typeof value === 'boolean') return value
    if (typeof value === 'number') return value !== 0
    return false
  })

  if (hasFormValue) return true

  const hasImage = Object.values(payload.imageUrls).some((value) => value.trim() !== '')
  return hasImage
}

export default function EventForm({ organizer, onEventCreated, onCancel, initialEvent }: EventFormProps) {
  const isDraftEnabled = !initialEvent
  const draftUserKey = organizer?.user_id || organizer.id

  // 既存イベントからschedulesを復元する関数
  const restoreSchedulesFromEvent = (event: any): EventSchedule[] => {
    // 既にschedulesデータがある場合はそれを使用
    if (event?.schedules && Array.isArray(event.schedules) && event.schedules.length > 0) {
      return event.schedules.map((s: any) => ({
        id: s.id || crypto.randomUUID(),
        date: s.date || '',
        start_time: s.start_time || '',
        end_time: s.end_time || ''
      }))
    }
    
    // 既存のevent_start_date, event_end_date, event_timeから復元
    if (event?.event_start_date && event?.event_end_date) {
      const startDate = String(event.event_start_date).split('T')[0]
      const endDate = String(event.event_end_date).split('T')[0]
      const timeStr = event.event_time || ''
      
      // 時間文字列をパース（例: "14:00〜17:00"）
      let startTime = ''
      let endTime = ''
      if (timeStr.includes('〜')) {
        const times = timeStr.split('〜')
        startTime = times[0]?.trim() || ''
        endTime = times[1]?.trim() || ''
      }
      
      // 日付の範囲を生成
      const schedules: EventSchedule[] = []
      const start = new Date(startDate)
      const end = new Date(endDate)
      
      for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
        schedules.push({
          id: crypto.randomUUID(),
          date: d.toISOString().split('T')[0],
          start_time: startTime,
          end_time: endTime
        })
      }
      
      return schedules
    }
    
    return []
  }

  const initialFormState = useMemo<EventFormState>(() => ({
    ...EVENT_FORM_EMPTY_STATE,
    event_name: initialEvent?.event_name || '',
    event_name_furigana: (initialEvent as any)?.event_name_furigana || '',
    genre: initialEvent?.genre || '',
    is_shizuoka_vocational_assoc_related: (initialEvent as any)?.is_shizuoka_vocational_assoc_related || false,
    opt_out_newspaper_publication: (initialEvent as any)?.opt_out_newspaper_publication || false,
    schedules: initialEvent ? restoreSchedulesFromEvent(initialEvent) : [],
    event_start_date: (initialEvent?.event_start_date as any) ? String(initialEvent?.event_start_date).split('T')[0] : '',
    event_end_date: (initialEvent?.event_end_date as any) ? String(initialEvent?.event_end_date).split('T')[0] : '',
    event_display_period: initialEvent?.event_display_period || '',
    event_period_notes: (initialEvent as any)?.event_period_notes || '',
    event_time: initialEvent?.event_time || '',
    application_start_date: (initialEvent as any)?.application_start_date ? String((initialEvent as any).application_start_date).split('T')[0] : '',
    application_end_date: (initialEvent as any)?.application_end_date ? String((initialEvent as any).application_end_date).split('T')[0] : '',
    application_display_period: (initialEvent as any)?.application_display_period || '',
    application_notes: (initialEvent as any)?.application_notes || '',
    ticket_release_start_date: (initialEvent as any)?.ticket_release_start_date ? String((initialEvent as any).ticket_release_start_date).split('T')[0] : '',
    ticket_sales_location: (initialEvent as any)?.ticket_sales_location || '',
    lead_text: initialEvent?.lead_text || '',
    event_description: initialEvent?.event_description || '',
    event_introduction_text: (initialEvent as any)?.event_introduction_text || '',
    venue_name: initialEvent?.venue_name || '',
    venue_postal_code: (initialEvent as any)?.venue_postal_code || '',
    venue_city: initialEvent?.venue_city || '',
    venue_town: (initialEvent as any)?.venue_town || '',
    venue_address: (initialEvent as any)?.venue_address || '',
    venue_latitude: (initialEvent as any)?.venue_latitude ? String((initialEvent as any).venue_latitude) : '',
    venue_longitude: (initialEvent as any)?.venue_longitude ? String((initialEvent as any).venue_longitude) : '',
    homepage_url: initialEvent?.homepage_url || '',
    related_page_url: (initialEvent as any)?.related_page_url || '',
    contact_name: (initialEvent as any)?.contact_name || '',
    contact_phone: (initialEvent as any)?.contact_phone || '',
    contact_email: (initialEvent as any)?.contact_email || '',
    parking_info: (initialEvent as any)?.parking_info || '',
    fee_info: (initialEvent as any)?.fee_info || '',
    organizer_info: (initialEvent as any)?.organizer_info || '',
  }), [initialEvent])

  const initialImageState = useMemo<EventImageState>(() => ({
    ...EVENT_IMAGE_INITIAL,
    main: initialEvent?.main_image_url || '',
    additional1: (initialEvent as any)?.additional_image1_url || '',
    additional2: (initialEvent as any)?.additional_image2_url || '',
    additional3: (initialEvent as any)?.additional_image3_url || '',
    additional4: (initialEvent as any)?.additional_image4_url || '',
  }), [initialEvent])

  const [loading, setLoading] = useState(false)
  const [addressLoading, setAddressLoading] = useState(false)
  const [eventId, setEventId] = useState<string>((initialEvent?.id as string) || '')
  const [formData, setFormData] = useState<EventFormState>(initialFormState)
  const [imageUrls, setImageUrls] = useState<EventImageState>(initialImageState)
  const [draftLoaded, setDraftLoaded] = useState(() => !isDraftEnabled)
  const [currentStep, setCurrentStep] = useState<1 | 2 | 3>(1) // ステップ1: 全部の情報入力、ステップ2: 確認、ステップ3: 登録完了
  const [submittedEvent, setSubmittedEvent] = useState<Event | null>(null) // 登録完了画面で表示するイベント情報

  // 編集モードかどうかを判定
  const isEditMode = !!(initialEvent?.id || eventId)

  const saveTimeoutRef = useRef<NodeJS.Timeout | null>(null)
  const lastPayloadRef = useRef<string>('')
  const draftExistsRef = useRef(false)
  useEffect(() => {
    setFormData(initialFormState)
    setImageUrls(initialImageState)
  }, [initialFormState, initialImageState])


  const upsertDraft = useCallback(
    async (payload: EventFormDraftPayload) => {
      if (!isDraftEnabled || !draftUserKey) return
      const { error } = await supabase
        .from('form_drafts')
        .upsert(
          {
            user_id: draftUserKey,
            form_type: EVENT_FORM_DRAFT_TYPE,
            payload,
            updated_at: new Date().toISOString(),
          },
          { onConflict: 'user_id, form_type' }
        )

      if (error) throw error
      draftExistsRef.current = true
    },
    [draftUserKey, isDraftEnabled]
  )

  const removeDraft = useCallback(async () => {
    if (!isDraftEnabled || !draftUserKey || !draftExistsRef.current) return
    const { error } = await supabase
      .from('form_drafts')
      .delete()
      .eq('user_id', draftUserKey)
      .eq('form_type', EVENT_FORM_DRAFT_TYPE)

    if (error) throw error
    draftExistsRef.current = false
  }, [draftUserKey, isDraftEnabled])

  const scheduleDraftUpsert = useCallback(
    (payload: EventFormDraftPayload) => {
      if (!isDraftEnabled) return

      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current)
      }

      saveTimeoutRef.current = setTimeout(async () => {
        saveTimeoutRef.current = null
        try {
          await upsertDraft(payload)
        } catch (error) {
          console.error('Failed to save event form draft:', error)
        }
      }, SAVE_DEBOUNCE_MS)
    },
    [isDraftEnabled, upsertDraft]
  )

  const scheduleDraftDeletion = useCallback(() => {
    if (!isDraftEnabled || !draftExistsRef.current) return

    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current)
    }

    saveTimeoutRef.current = setTimeout(async () => {
      saveTimeoutRef.current = null
      try {
        await removeDraft()
      } catch (error) {
        console.error('Failed to delete event form draft:', error)
      }
    }, SAVE_DEBOUNCE_MS)
  }, [isDraftEnabled, removeDraft])
  const handleClearForm = useCallback(() => {
    setFormData(initialFormState)
    setImageUrls(initialImageState)
    lastPayloadRef.current = ''
    if (isDraftEnabled) {
      scheduleDraftDeletion()
    }
    onCancel()
  }, [initialFormState, initialImageState, isDraftEnabled, scheduleDraftDeletion, onCancel])


  useEffect(() => {
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current)
      }
    }
  }, [])

  useEffect(() => {
    if (!isDraftEnabled) return
    let isCancelled = false

    const loadDraft = async () => {
      if (!draftUserKey) {
        if (!isCancelled) setDraftLoaded(true)
        return
      }

      try {
        const { data, error } = await supabase
          .from('form_drafts')
          .select('payload')
          .eq('user_id', draftUserKey)
          .eq('form_type', EVENT_FORM_DRAFT_TYPE)
          .limit(1)

        if (error) throw error

        const record = data?.[0]

        if (record?.payload && !isCancelled) {
          const payload = record.payload as Partial<EventFormDraftPayload>
          const restoredFormData: EventFormState = {
            ...EVENT_FORM_EMPTY_STATE,
            ...(payload.formData ?? {}),
          }
          const restoredImages: EventImageState = {
            ...EVENT_IMAGE_INITIAL,
            ...(payload.imageUrls ?? {}),
          }

          setFormData(restoredFormData)
          setImageUrls(restoredImages)

          draftExistsRef.current = true
          lastPayloadRef.current = JSON.stringify({
            formData: restoredFormData,
            imageUrls: restoredImages,
          })
        }
      } catch (error) {
        console.error('Failed to load event form draft:', error)
      } finally {
        if (!isCancelled) setDraftLoaded(true)
      }
    }

    loadDraft()

    return () => {
      isCancelled = true
    }
  }, [draftUserKey, isDraftEnabled])

  useEffect(() => {
    if (!isDraftEnabled || !draftLoaded) return

    const payload: EventFormDraftPayload = {
      formData,
      imageUrls,
    }

    if (!hasEventDraftContent(payload)) {
      lastPayloadRef.current = ''
      scheduleDraftDeletion()
      return
    }

    const serializedPayload = JSON.stringify(payload)
    if (lastPayloadRef.current === serializedPayload) return

    lastPayloadRef.current = serializedPayload
    scheduleDraftUpsert(payload)
  }, [formData, imageUrls, isDraftEnabled, draftLoaded, scheduleDraftUpsert, scheduleDraftDeletion])

  // 日付を日本語形式にフォーマット（例: 2025-03-11 → "3月11日"）
  const formatDateToJapanese = (dateString: string): string => {
    if (!dateString) return ''
    const date = new Date(dateString + 'T00:00:00') // タイムゾーン対応
    const month = date.getMonth() + 1
    const day = date.getDate()
    return `${month}月${day}日`
  }

  // 日付範囲を日本語形式にフォーマット（例: 2025-03-11, 2025-03-13 → "3月11日〜13日"）
  const formatDateRangeToJapanese = (startDate: string, endDate: string): string => {
    if (!startDate || !endDate) return ''
    
    const start = new Date(startDate + 'T00:00:00')
    const end = new Date(endDate + 'T00:00:00')
    
    const startYear = start.getFullYear()
    const startMonth = start.getMonth() + 1
    const startDay = start.getDate()
    
    const endYear = end.getFullYear()
    const endMonth = end.getMonth() + 1
    const endDay = end.getDate()
    
    // 同じ年の場合
    if (startYear === endYear) {
      // 同じ月の場合
      if (startMonth === endMonth) {
        return `${startMonth}月${startDay}日〜${endDay}日`
      } else {
        // 違う月の場合
        return `${startMonth}月${startDay}日〜${endMonth}月${endDay}日`
      }
    } else {
      // 違う年の場合
      return `${startYear}年${startMonth}月${startDay}日〜${endYear}年${endMonth}月${endDay}日`
    }
  }

  // schedulesから表示期間を自動生成
  const generateDisplayPeriodFromSchedules = (schedules: EventSchedule[]): string => {
    if (!schedules || schedules.length === 0) return ''
    
    const datesWithData = schedules.filter(s => s.date).map(s => s.date)
    if (datesWithData.length === 0) return ''
    
    const sortedDates = [...datesWithData].sort()
    const firstDate = sortedDates[0]
    const lastDate = sortedDates[sortedDates.length - 1]
    
    if (firstDate === lastDate) {
      return formatDateToJapanese(firstDate)
    }
    
    return formatDateRangeToJapanese(firstDate, lastDate)
  }

  // schedulesが変更されたときに表示期間を自動更新
  useEffect(() => {
    if (formData.schedules && formData.schedules.length > 0) {
      const autoDisplayPeriod = generateDisplayPeriodFromSchedules(formData.schedules)
      if (autoDisplayPeriod) {
        setFormData(prev => {
          // 既に同じ値が設定されている場合は更新しない
          if (prev.event_display_period === autoDisplayPeriod) return prev
          return { ...prev, event_display_period: autoDisplayPeriod }
        })
      }
    }
  }, [JSON.stringify(formData.schedules.map(s => ({ date: s.date })))])

  const prefectures = [
    '北海道', '青森県', '岩手県', '宮城県', '秋田県', '山形県', '福島県',
    '茨城県', '栃木県', '群馬県', '埼玉県', '千葉県', '東京都', '神奈川県',
    '新潟県', '富山県', '石川県', '福井県', '山梨県', '長野県',
    '岐阜県', '静岡県', '愛知県', '三重県',
    '滋賀県', '京都府', '大阪府', '兵庫県', '奈良県', '和歌山県',
    '鳥取県', '島根県', '岡山県', '広島県', '山口県',
    '徳島県', '香川県', '愛媛県', '高知県',
    '福岡県', '佐賀県', '長崎県', '熊本県', '大分県', '宮崎県', '鹿児島県', '沖縄県'
  ]

  const cardStyle = {
    background: '#FFFFFF',
    boxShadow: '0px 2px 8px rgba(0, 0, 0, 0.08)',
    borderRadius: '16px',
    padding: '20px',
    marginBottom: '24px'
  }

  const sectionTitleStyle = {
    fontFamily: '"Inter", "Noto Sans JP", sans-serif',
    fontSize: '20px',
    fontStyle: 'italic' as const,
    fontWeight: 700,
    lineHeight: '120%',
    color: '#2C3E50',
    marginBottom: '24px',
    textAlign: 'left' as const,
    paddingLeft: '4px'
  }

  const fieldsContainerStyle = {
    display: 'flex',
    flexDirection: 'column' as const,
    gap: '24px',
    alignItems: 'center' as const
  }

  const fieldWrapperStyle = {
    width: '100%',
    maxWidth: '289px',
    position: 'relative' as const
  }

  const labelStyle = {
    fontFamily: '"Inter", "Noto Sans JP", sans-serif',
    fontSize: '14px',
    fontStyle: 'italic' as const,
    fontWeight: 700,
    lineHeight: '120%',
    color: '#2C3E50',
    marginBottom: '8px',
    display: 'block' as const
  }

  const formFieldStyle = (hasError: boolean, options?: { minHeight?: number }) => ({
    boxSizing: 'border-box' as const,
    display: 'flex',
    flexDirection: 'row' as const,
    alignItems: options?.minHeight && options.minHeight > 44 ? 'flex-start' : 'center',
    padding: '0 16px',
    gap: '10px',
    width: '100%',
    minWidth: 0,
    minHeight: options?.minHeight ?? 44,
    height: options?.minHeight ? undefined : '44px',
    maxWidth: '289px',
    background: '#FFFFFF',
    border: hasError ? '1px solid #FF3B30' : '1px solid #E9ECEF',
    borderRadius: '8px'
  })

  const inputStyle = (hasValue: boolean) => ({
    fontFamily: '"Inter", "Noto Sans JP", sans-serif',
    fontSize: '15px',
    lineHeight: '150%',
    color: hasValue ? '#2C3E50' : '#6C757D',
    border: 'none',
    outline: 'none',
    width: '100%',
    background: 'transparent',
    textAlign: 'left' as const
  })

  const textareaStyle = (hasValue: boolean) => ({
    fontFamily: '"Inter", "Noto Sans JP", sans-serif',
    fontSize: '15px',
    lineHeight: '150%',
    color: hasValue ? '#2C3E50' : '#6C757D',
    border: 'none',
    outline: 'none',
    width: '100%',
    background: 'transparent',
    resize: 'none' as const
  })

  const buttonPrimaryStyle = {
    display: 'flex',
    flexDirection: 'row' as const,
    justifyContent: 'center',
    alignItems: 'center',
    padding: '16px 24px',
    gap: '10px',
    width: '100%',
    maxWidth: '157px',
    height: '48px',
    background: '#FF8A5C',
    borderRadius: '8px',
    border: 'none',
    fontFamily: 'Inter, sans-serif',
    fontSize: '16px',
    fontWeight: 700,
    lineHeight: '19px',
    color: '#FFFFFF',
    cursor: 'pointer'
  }

  const buttonSecondaryStyle = {
    display: 'flex',
    flexDirection: 'row' as const,
    justifyContent: 'center',
    alignItems: 'center',
    padding: '16px 24px',
    gap: '10px',
    width: '100%',
    maxWidth: '157px',
    height: '48px',
    background: '#FFFFFF',
    borderRadius: '8px',
    border: '1px solid #E5E5E5',
    fontFamily: 'Inter, sans-serif',
    fontSize: '16px',
    fontWeight: 700,
    lineHeight: '19px',
    color: '#000000',
    cursor: 'pointer'
  }

  const rangeContainerStyle = {
    display: 'flex',
    alignItems: 'center',
    gap: '12px',
    width: '100%',
    padding: '12px 16px',
    minHeight: 56,
    background: '#FFFFFF',
    border: '1px solid #E5E5E5',
    borderRadius: '8px',
    boxSizing: 'border-box' as const,
    minWidth: 0
  }

  const rangeSeparatorStyle = {
    fontFamily: 'Inter, sans-serif',
    fontSize: '16px',
    fontWeight: 700,
    color: '#666666',
    display: 'flex',
    alignItems: 'center',
    justifyContent: 'center',
    padding: '0 4px'
  }

  // 必須項目のバリデーション（最初の未入力へスクロール＆フォーカス）
  const validateRequired = (): { ok: boolean; message?: string } => {
    // 日程のバリデーション
    if (!formData.schedules || formData.schedules.length === 0) {
      return { ok: false, message: 'イベント日程を1つ以上入力してください。' }
    }
    
    for (let i = 0; i < formData.schedules.length; i++) {
      const schedule = formData.schedules[i]
      if (!schedule.date || !schedule.start_time || !schedule.end_time) {
        return { 
          ok: false, 
          message: `日程${i + 1}: 日付、開始時間、終了時間はすべて必須です。` 
        }
      }
    }
    
    const requiredList: Array<{ key: keyof typeof formData; label: string }> = [
      { key: 'event_name', label: 'イベント名称' },
      { key: 'event_name_furigana', label: 'イベント名称フリガナ' },
      { key: 'genre', label: 'ジャンル' },
      { key: 'event_display_period', label: '開催期間(表示用)' },
      { key: 'lead_text', label: 'リード文' },
      { key: 'event_description', label: 'イベント紹介文' },
      { key: 'venue_name', label: '会場名称' },
      { key: 'contact_name', label: '問い合わせ先名称' },
      { key: 'contact_phone', label: '電話番号' },
    ]

    for (const { key, label } of requiredList) {
      const value = (formData as any)[key]
      if (value === undefined || value === null || String(value).trim() === '') {
        const el = document.getElementById(`field-${String(key)}`)
        if (el) {
          el.scrollIntoView({ behavior: 'smooth', block: 'center' })
          ;(el as HTMLInputElement).focus()
        }
        return { ok: false, message: `${label}を入力してください。` }
      }
    }
    
    return { ok: true }
  }


  // 郵便番号から住所を取得する関数
  const fetchAddressFromPostalCode = async (postalCode: string) => {
    if (!postalCode || postalCode.length !== 7) return

    setAddressLoading(true)
    try {
      const response = await fetch(`https://zipcloud.ibsnet.co.jp/api/search?zipcode=${postalCode}`)
      const data = await response.json()
      
      if (data.status === 200 && data.results && data.results.length > 0) {
        const result = data.results[0]
        setFormData(prev => ({
          ...prev,
          venue_city: prefectures.includes(result.address1) ? result.address1 : '',
          venue_town: result.address2 || '',
          venue_address: result.address3 || '',
        }))
      } else {
        alert('郵便番号が見つかりませんでした。')
      }
    } catch (error) {
      console.error('Address fetch error:', error)
      alert('住所の取得に失敗しました。')
    } finally {
      setAddressLoading(false)
    }
  }

  // ステップ1からステップ2へ（確認画面へ）
  const handleNextToConfirmation = () => {
    const result = validateRequired()
    if (!result.ok) {
      alert(result.message)
      return
    }
    setCurrentStep(2)
  }

  // ステップ2からステップ3へ（実際にイベントを作成）
  const handleSubmit = async () => {
    setLoading(true)

    // 更新モードかどうかを明確に判定（initialEventが渡されている or eventIdが存在）
    // tryブロック外で定義してcatchからも参照可能にする
    const isUpdateMode = !!(initialEvent?.id || eventId)
    const targetEventId = initialEvent?.id || eventId

    try {

      // schedulesからevent_start_date、event_end_date、event_timeを自動生成
      const sortedSchedules = [...formData.schedules].sort((a, b) => 
        a.date.localeCompare(b.date)
      )
      const firstSchedule = sortedSchedules[0]
      const lastSchedule = sortedSchedules[sortedSchedules.length - 1]
      
      // event_start_dateとevent_end_dateを設定
      const autoEventStartDate = firstSchedule?.date || ''
      const autoEventEndDate = lastSchedule?.date || ''
      
      // event_timeを生成（最初の日程の時間を使用、またはすべての日程の時間を結合）
      let autoEventTime = ''
      if (firstSchedule && firstSchedule.start_time && firstSchedule.end_time) {
        if (sortedSchedules.length === 1) {
          autoEventTime = `${firstSchedule.start_time}〜${firstSchedule.end_time}`
        } else {
          // 複数日程の場合、最初の日程の時間を使用
          autoEventTime = `${firstSchedule.start_time}〜${firstSchedule.end_time}`
        }
      }

      // 送信データの最終チェック
      const submitData: any = {
        ...formData,
        organizer_id: organizer.id,
        event_start_date: autoEventStartDate,
        event_end_date: autoEventEndDate,
        event_time: autoEventTime,
        venue_latitude: formData.venue_latitude ? parseFloat(formData.venue_latitude) : null,
        venue_longitude: formData.venue_longitude ? parseFloat(formData.venue_longitude) : null,
        // schedulesをJSON形式で保存（将来的に専用テーブルに移行可能）
        schedules: JSON.stringify(formData.schedules),
      }

      // 作成時のみ、空文字をnullに変換（更新時は既存値を保持したいので変換しない）
      if (!targetEventId) {
        Object.keys(submitData).forEach(key => {
          if (submitData[key] === '') {
            submitData[key] = null
          }
        })
      }

      console.log('Submitting event data:', submitData)

      let finalEvent

      if (isUpdateMode && targetEventId) {
        // 更新フロー: 空文字は上書きしない（既存値保持）。
        const updatePayload: any = {}
        Object.entries(submitData).forEach(([key, value]) => {
          if (value === '' || value === undefined) return // skip empty
          updatePayload[key] = value
        })
        // 画像は指定があるものだけ更新
        if (imageUrls.main) updatePayload.main_image_url = imageUrls.main
        if (imageUrls.additional1) updatePayload.additional_image1_url = imageUrls.additional1
        if (imageUrls.additional2) updatePayload.additional_image2_url = imageUrls.additional2
        if (imageUrls.additional3) updatePayload.additional_image3_url = imageUrls.additional3
        if (imageUrls.additional4) updatePayload.additional_image4_url = imageUrls.additional4

        // 可変でnullを許す日付フィールドは明示的にnullを指定したい場合にのみ対応
        // （UIで空にしただけでは上書きしない方針）

        const { data: updated, error: updateError } = await supabase
          .from('events')
          .update(updatePayload)
          .eq('id', targetEventId)
          .select()
          .single()

        if (updateError) throw updateError
        finalEvent = updated
      } else {
        // 作成フロー
        const { data: eventData, error: eventError } = await supabase
          .from('events')
          .insert(submitData)
          .select()
          .single()

        if (eventError) throw eventError
        setEventId(eventData.id)

        const { data: updatedData, error: updateError } = await supabase
          .from('events')
          .update({
            main_image_url: imageUrls.main || null,
            additional_image1_url: imageUrls.additional1 || null,
            additional_image2_url: imageUrls.additional2 || null,
            additional_image3_url: imageUrls.additional3 || null,
            additional_image4_url: imageUrls.additional4 || null,
          })
          .eq('id', eventData.id)
          .select()
          .single()

        if (updateError) throw updateError
        finalEvent = updatedData
      }

      if (!isUpdateMode) {
        try {
          await removeDraft()
          lastPayloadRef.current = ''
          setDraftLoaded(false)
        } catch (draftError) {
          console.error('Failed to clear event form draft after submit:', draftError)
        }
      }

      // ステップ3（登録完了画面）へ遷移
      setSubmittedEvent(finalEvent)
      setCurrentStep(3)
    } catch (error) {
      console.error('Event creation failed:', error)
      console.error('Error details:', JSON.stringify(error, null, 2))
      
      let errorMessage = '不明なエラー'
      
      if (error instanceof Error) {
        errorMessage = error.message
      } else if (typeof error === 'object' && error !== null) {
        // Supabase error objectの場合
        if ('message' in error) {
          errorMessage = String(error.message)
        } else if ('details' in error) {
          errorMessage = String(error.details)
        } else if ('hint' in error) {
          errorMessage = String(error.hint)
        } else {
          errorMessage = JSON.stringify(error)
        }
      }
      
      alert(`イベントの${isUpdateMode ? '更新' : '作成'}に失敗しました。エラー: ${errorMessage}`)
    } finally {
      setLoading(false)
    }
  }

  // ステップ3: 登録完了画面
  if (currentStep === 3 && submittedEvent) {
    return (
      <div style={{
        minHeight: '100vh',
        width: '100%',
        background: '#FFFFFF', // 外側は白
        display: 'flex',
        justifyContent: 'center'
      }}>
        <div style={{
          width: '393px',
          minWidth: '393px',
          flexShrink: 0,
          background: '#FFF5F0', // スマホフレーム範囲内は薄いオレンジ
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
          paddingTop: '0px',
          paddingBottom: '32px',
          paddingLeft: '20px',
          paddingRight: '20px',
          boxSizing: 'border-box'
        }}>
          {/* プログレスバー */}
          <div style={{
            width: '100%',
            height: '93px',
            marginTop: '32px',
            marginBottom: '16px',
            background: 'white',
            borderRadius: '16px',
            boxShadow: '0px 8px 32px rgba(0, 0, 0, 0.08)', // Shadow LG
            overflow: 'hidden',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            boxSizing: 'border-box'
          }}>
            <ProgressBar type="organizer" step="complete" />
          </div>

          {/* コンテンツ */}
          <div style={{
            width: '100%',
            background: 'white',
            borderRadius: '16px',
            boxShadow: '0px 8px 32px rgba(0, 0, 0, 0.08)', // Shadow LG
            paddingTop: '32px',
            paddingBottom: '32px',
            paddingLeft: '20px',
            paddingRight: '20px',
            boxSizing: 'border-box',
            textAlign: 'center'
          }}>
            <h1 style={{
              margin: '0 0 16px',
              fontSize: '24px',
              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
              fontStyle: 'normal',
              fontWeight: 700,
              color: '#2C3E50'
            }}>
              登録完了
            </h1>
            <p style={{
              margin: '0 0 8px',
              fontSize: '14px',
              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
              fontStyle: 'normal',
              fontWeight: 400,
              color: '#6C757D'
            }}>
              イベントが完了しました
            </p>
            <p style={{
              margin: '0 0 32px',
              fontSize: '14px',
              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
              fontStyle: 'normal',
              fontWeight: 400,
              color: '#6C757D'
            }}>
              運営の承諾があり次第出店者募集を始めます
            </p>

            {/* ホームへ戻るボタン */}
            <button
              type="button"
              onClick={() => {
                onEventCreated(submittedEvent)
                onCancel()
              }}
              style={{
                width: '100%',
                padding: '16px 24px',
                background: '#FF8A5C', // Primary Default
                borderRadius: '12px',
                border: 'none',
                fontSize: '16px',
                fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                fontStyle: 'normal',
                fontWeight: 700,
                color: 'white',
                cursor: 'pointer',
                boxShadow: '0px 2px 8px rgba(0, 0, 0, 0.08)', // Shadow SM
              }}
            >
              ホームへ戻る
            </button>
          </div>
        </div>
      </div>
    )
  }

  // ステップ2: 確認画面
  if (currentStep === 2) {
    return (
      <div style={{
        minHeight: '100vh',
        width: '100%',
        background: '#FFFFFF', // 外側は白
        display: 'flex',
        justifyContent: 'center'
      }}>
        <div style={{
          width: '393px',
          minWidth: '393px',
          flexShrink: 0,
          background: '#FFF5F0', // スマホフレーム範囲内は薄いオレンジ
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
          paddingTop: '0px',
          paddingBottom: '32px',
          paddingLeft: '20px',
          paddingRight: '20px',
          boxSizing: 'border-box'
        }}>
          {/* プログレスバー */}
          <div style={{
            width: '100%',
            height: '93px',
            marginTop: '32px',
            marginBottom: '16px',
            background: 'white',
            borderRadius: '16px',
            boxShadow: '0px 8px 32px rgba(0, 0, 0, 0.08)', // Shadow LG
            overflow: 'hidden',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            boxSizing: 'border-box'
          }}>
            <ProgressBar type="organizer" step="confirmation" />
          </div>

          {/* フォーム */}
          <div style={{
            width: '100%',
            background: 'white',
            borderRadius: '16px',
            boxShadow: '0px 8px 32px rgba(0, 0, 0, 0.08)', // Shadow LG
            paddingTop: '32px',
            paddingBottom: '32px',
            paddingLeft: '20px',
            paddingRight: '20px',
            boxSizing: 'border-box'
          }}>
            {/* タイトル */}
            <h2 style={{
              margin: '0 0 24px',
              fontSize: '20px',
              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
              fontStyle: 'normal',
              fontWeight: 700,
              color: '#2C3E50'
            }}>
              イベント情報を確認してください
            </h2>
            {/* イベント名 */}
            <label style={{
              display: 'block',
              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
              fontSize: '14px',
              fontStyle: 'normal',
              fontWeight: 700,
              color: '#2C3E50',
              marginBottom: '8px'
            }}>
              イベント名
            </label>
            <p style={{
              margin: '0 0 24px',
              fontSize: '15px',
              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
              fontStyle: 'normal',
              fontWeight: 400,
              color: '#2C3E50'
            }}>
              {formData.event_name || '未入力'}
            </p>
            {/* イベント名フリガナ */}
            <label style={{
              display: 'block',
              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
              fontSize: '14px',
              fontStyle: 'normal',
              fontWeight: 700,
              color: '#2C3E50',
              marginBottom: '8px'
            }}>
              イベント名フリガナ
            </label>
            <p style={{
              margin: '0 0 24px',
              fontSize: '15px',
              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
              fontStyle: 'normal',
              fontWeight: 400,
              color: '#2C3E50'
            }}>
              {formData.event_name_furigana || '未入力'}
            </p>

            {/* ジャンル */}
            <label style={{
              display: 'block',
              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
              fontSize: '14px',
              fontStyle: 'normal',
              fontWeight: 700,
              color: '#2C3E50',
              marginBottom: '8px'
            }}>
              ジャンル
            </label>
            <p style={{
              margin: '0 0 24px',
              fontSize: '15px',
              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
              fontStyle: 'normal',
              fontWeight: 400,
              color: '#2C3E50'
            }}>
              {formData.genre || '未選択'}
            </p>
            {/* その他のフィールドは簡略化 */}
            {formData.schedules && formData.schedules.length > 0 && (
              <>
                <label style={{
                  display: 'block',
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  color: '#2C3E50',
                  marginBottom: '8px'
                }}>
                  イベント日程
                </label>
                {formData.schedules.map((schedule, index) => (
                  <p key={index} style={{
                    margin: index > 0 ? '0 0 24px' : '0 0 24px',
                    fontSize: '15px',
                    fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                    fontStyle: 'normal',
                    fontWeight: 400,
                    color: '#2C3E50'
                  }}>
                    {schedule.date ? formatDateToJapanese(schedule.date) : '未入力'}
                  </p>
                ))}
              </>
            )}
            {formData.venue_name && (
              <>
                <label style={{
                  display: 'block',
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  color: '#2C3E50',
                  marginBottom: '8px'
                }}>
                  会場名
                </label>
                <p style={{
                  margin: '0 0 24px',
                  fontSize: '15px',
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontStyle: 'normal',
                  fontWeight: 400,
                  color: '#2C3E50'
                }}>
                  {formData.venue_name}
                </p>
              </>
            )}
            {formData.contact_name && (
              <>
                <label style={{
                  display: 'block',
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  color: '#2C3E50',
                  marginBottom: '8px'
                }}>
                  連絡先担当者名
                </label>
                <p style={{
                  margin: '0 0 24px',
                  fontSize: '15px',
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontStyle: 'normal',
                  fontWeight: 400,
                  color: '#2C3E50'
                }}>
                  {formData.contact_name}
                </p>
              </>
            )}
          </div>

          {/* ボタン */}
          <div style={{ display: 'flex', gap: '16px', marginTop: '24px' }}>
            <button
              type="button"
              onClick={() => setCurrentStep(1)}
              style={{
                flex: 1,
                height: '52px',
                background: '#FFFFFF',
                border: '1px solid #E5E7EB',
                borderRadius: '12px',
                fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                fontSize: '15px',
                fontWeight: 700,
                color: '#6C757D',
                cursor: 'pointer',
                boxShadow: '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)'
              }}
            >
              戻る
            </button>
            <button
              type="button"
              onClick={handleSubmit}
              disabled={loading}
              style={{
                flex: 1,
                height: '52px',
                background: loading ? '#CCCCCC' : '#FF8A5C',
                border: 'none',
                borderRadius: '12px',
                fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                fontSize: '15px',
                fontWeight: 700,
                color: '#FFFFFF',
                cursor: loading ? 'not-allowed' : 'pointer',
                boxShadow: loading ? 'none' : '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)'
              }}
            >
              {loading ? (eventId ? '更新中...' : '作成中...') : '登録する'}
            </button>
          </div>
        </div>
      </div>
    )
  }

  // ステップ1: 全部の情報入力
  return (
    <div style={{
      minHeight: '100vh',
      width: '100%',
      background: '#FFFFFF', // 外側は白
      display: 'flex',
      justifyContent: 'center'
    }}>
      <div style={{
        width: '393px',
        minWidth: '393px',
        flexShrink: 0,
        background: '#FFF5F0', // スマホフレーム範囲内は薄いオレンジ
        display: 'flex',
        flexDirection: 'column',
        alignItems: 'center',
        paddingTop: '0px',
        paddingBottom: '32px',
        paddingLeft: '20px',
        paddingRight: '20px',
        boxSizing: 'border-box'
      }}>
        {/* プログレスバー */}
        <div style={{
          width: '100%',
          height: '93px',
          marginTop: '32px',
          marginBottom: '16px',
          background: 'white',
          borderRadius: '16px',
          boxShadow: '0px 8px 32px rgba(0, 0, 0, 0.08)', // Shadow LG
          overflow: 'hidden',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          boxSizing: 'border-box'
        }}>
          <ProgressBar type="organizer" step="form" />
        </div>

        {/* フォーム */}
        <form onSubmit={(e) => { e.preventDefault(); handleNextToConfirmation(); }} style={{ width: '100%' }}>
          <div style={{
            width: '100%',
            background: 'white',
            borderRadius: '16px',
            boxShadow: '0px 8px 32px rgba(0, 0, 0, 0.08)', // Shadow LG
            paddingTop: '32px',
            paddingBottom: '32px',
            paddingLeft: '20px',
            paddingRight: '20px',
            boxSizing: 'border-box'
          }}>
            {/* タイトル */}
            <h2 style={{
              margin: '0 0 24px',
              fontSize: '20px',
              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
              fontStyle: 'normal',
              fontWeight: 700,
              color: '#2C3E50'
            }}>
              イベント情報を入力してください
            </h2>
            <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
              {/* イベント名 */}
              <div style={{ width: '100%', position: 'relative' }} data-error-field="event_name">
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>イベント名</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  height: '44px',
                  padding: '0 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px',
                  display: 'flex',
                  alignItems: 'center'
                }}>
                  <input
                    id="field-event_name"
                    type="text"
                    required
                    maxLength={50}
                    value={formData.event_name}
                    onChange={(e) => setFormData({ ...formData, event_name: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.event_name ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent'
                    }}
                    placeholder="例: 静岡フリーマーケット"
                  />
                </div>
              </div>

              {/* イベント名フリガナ */}
              <div style={{ width: '100%', position: 'relative' }} data-error-field="event_name_furigana">
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>イベント名フリガナ</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  height: '44px',
                  padding: '0 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px',
                  display: 'flex',
                  alignItems: 'center'
                }}>
                  <input
                    id="field-event_name_furigana"
                    type="text"
                    required
                    maxLength={50}
                    value={formData.event_name_furigana}
                    onChange={(e) => setFormData({ ...formData, event_name_furigana: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.event_name_furigana ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent'
                    }}
                    placeholder="例: シズオカフリーマーケット"
                  />
                </div>
              </div>

              {/* ジャンル */}
              <div style={{ width: '100%', position: 'relative' }} data-error-field="genre">
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>ジャンル</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  height: '44px',
                  padding: '0 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px',
                  display: 'flex',
                  alignItems: 'center',
                  position: 'relative'
                }}>
                  <select
                    id="field-genre"
                    required
                    value={formData.genre}
                    onChange={(e) => setFormData({ ...formData, genre: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.genre ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent',
                      appearance: 'none',
                      cursor: 'pointer',
                      paddingRight: '30px'
                    }}
                  >
                    <option value="">選択してください</option>
                    <option value="祭り・花火大会">祭り・花火大会</option>
                    <option value="音楽・ライブ">音楽・ライブ</option>
                    <option value="スポーツ">スポーツ</option>
                    <option value="文化・芸術">文化・芸術</option>
                    <option value="その他">その他</option>
                  </select>
                  <svg
                    width="8"
                    height="5"
                    viewBox="0 0 8 5"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    style={{
                      position: 'absolute',
                      right: '16px',
                      top: '50%',
                      transform: 'translateY(-50%)',
                      pointerEvents: 'none'
                    }}
                  >
                    <path d="M4 5L0 0H8L4 5Z" fill="#6C757D"/>
                  </svg>
                </div>
              </div>

          {/* 開催期間 */}
          <div style={{ marginTop: '24px' }}>
            <h2 style={{
              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
              fontSize: '18px',
              fontStyle: 'normal',
              fontWeight: 700,
              lineHeight: '120%',
              color: '#2C3E50',
              marginBottom: '20px'
            }}>開催期間</h2>
            <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
              {/* イベント日程 */}
              <div style={{ width: '100%' }}>
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>イベント日程</label>
                
                {/* 日程リスト */}
                {formData.schedules.map((schedule, index) => (
                  <div key={schedule.id} style={{ marginBottom: '16px' }}>
                    <div style={{
                      background: '#FFFFFF',
                      border: '1px solid #E5E5E5',
                      borderRadius: '8px',
                      padding: '16px',
                      position: 'relative'
                    }}>
                      {/* 削除ボタン */}
                      {formData.schedules.length > 1 && (
                        <button
                          type="button"
                          onClick={() => {
                            const newSchedules = formData.schedules.filter(s => s.id !== schedule.id)
                            setFormData({ ...formData, schedules: newSchedules })
                          }}
                          style={{
                            position: 'absolute',
                            top: '8px',
                            right: '8px',
                            background: 'transparent',
                            border: 'none',
                            fontSize: '20px',
                            color: '#999999',
                            cursor: 'pointer',
                            width: '32px',
                            height: '32px',
                      display: 'flex',
                      alignItems: 'center',
                            justifyContent: 'center'
                          }}
                        >
                          ×
                        </button>
                      )}
                      
                      {/* 日付入力 */}
                      <div style={{ marginBottom: '12px' }}>
                      <input
                          type="date"
                          required
                          value={schedule.date}
                          onChange={(e) => {
                            const newSchedules = [...formData.schedules]
                            newSchedules[index].date = e.target.value
                            setFormData({ ...formData, schedules: newSchedules })
                          }}
                          style={{
                            fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                            fontSize: '15px',
                            lineHeight: '150%',
                            color: schedule.date ? '#2C3E50' : '#6C757D',
                            border: '1px solid #E5E5E5',
                            padding: '12px 16px',
                            width: '100%',
                            background: '#FFFFFF',
                            borderRadius: '8px',
                            boxSizing: 'border-box',
                            outline: 'none'
                          }}
                          placeholder="YYYY/MM/DD"
                        />
          </div>

                      {/* 開始時間と終了時間 */}
                      <div style={{ display: 'flex', gap: '12px', alignItems: 'center' }}>
                        <div style={{ flex: 1 }}>
                          <label style={{
                            fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                            fontSize: '12px',
                            fontStyle: 'normal',
                            fontWeight: 700,
                            lineHeight: '1.4',
                            marginBottom: '4px',
                            color: '#666666',
                            display: 'block'
                          }}>
                            開始時間 <span style={{ color: '#FF3B30' }}>*</span>
                          </label>
                  <input
                            type="time"
                    required
                            value={schedule.start_time}
                            onChange={(e) => {
                              const newSchedules = [...formData.schedules]
                              newSchedules[index].start_time = e.target.value
                              setFormData({ ...formData, schedules: newSchedules })
                            }}
                            style={{
                              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                              fontSize: '15px',
                              lineHeight: '150%',
                              color: schedule.start_time ? '#2C3E50' : '#6C757D',
                              border: '1px solid #E5E5E5',
                              padding: '12px 16px',
                              width: '100%',
                              background: '#FFFFFF',
                              borderRadius: '8px',
                              boxSizing: 'border-box',
                              outline: 'none'
                            }}
                          />
                        </div>
                        <span style={{
                          fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                          fontSize: '14px',
                          fontWeight: 700,
                          color: '#666666',
                          marginTop: '20px'
                        }}>
                          〜
                        </span>
                        <div style={{ flex: 1 }}>
                          <label style={{
                            fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                            fontSize: '12px',
                            fontStyle: 'normal',
                            fontWeight: 700,
                            lineHeight: '1.4',
                            marginBottom: '4px',
                            color: '#666666',
                            display: 'block'
                          }}>
                            終了時間 <span style={{ color: '#FF3B30' }}>*</span>
                          </label>
                  <input
                            type="time"
                    required
                            value={schedule.end_time}
                            onChange={(e) => {
                              const newSchedules = [...formData.schedules]
                              newSchedules[index].end_time = e.target.value
                              setFormData({ ...formData, schedules: newSchedules })
                            }}
                            style={{
                              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                              fontSize: '15px',
                              lineHeight: '150%',
                              color: schedule.end_time ? '#2C3E50' : '#6C757D',
                              border: '1px solid #E5E5E5',
                              padding: '12px 16px',
                              width: '100%',
                              background: '#FFFFFF',
                              borderRadius: '8px',
                              boxSizing: 'border-box',
                              outline: 'none'
                            }}
                  />
                </div>
                      </div>
                    </div>
                  </div>
                ))}
                
                {/* 日程追加ボタン */}
                <button
                  type="button"
                  onClick={() => {
                    const newSchedule: EventSchedule = {
                      id: crypto.randomUUID(),
                      date: '',
                      start_time: '',
                      end_time: ''
                    }
                    setFormData({
                      ...formData,
                      schedules: [...formData.schedules, newSchedule]
                    })
                  }}
                  style={{
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px',
                    padding: '12px 16px',
                    width: '100%',
                    background: '#F7F7F7',
                    border: '1px solid #E5E5E5',
                    borderRadius: '8px',
                    cursor: 'pointer',
                    fontFamily: 'Inter, sans-serif',
                    fontSize: '16px',
                    fontWeight: 500,
                    color: '#000000'
                  }}
                >
                  <span style={{ fontSize: '20px', fontWeight: 700 }}>+</span>
                  <span>日程を追加</span>
                </button>
              </div>

              <div style={{ width: '100%', position: 'relative' }}>
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>イベント開催期間(表示用)</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  height: '44px',
                  padding: '0 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px',
                  display: 'flex',
                  alignItems: 'center'
                }}>
                  <input
                    id="field-event_display_period"
                    type="text"
                    required
                    maxLength={50}
                    value={formData.event_display_period}
                    onChange={(e) => setFormData({ ...formData, event_display_period: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.event_display_period ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent'
                    }}
                    placeholder="自動生成されます（手動編集も可能）"
                  />
                </div>
              </div>

              <div style={{ width: '100%', position: 'relative' }}>
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>開催期間に関する補足（任意）</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  minHeight: '96px',
                  padding: '12px 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px'
                }}>
                  <textarea
                    value={formData.event_period_notes}
                    onChange={(e) => setFormData({ ...formData, event_period_notes: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.event_period_notes ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent',
                      resize: 'none',
                      minHeight: '72px'
                    }}
                    placeholder="補足事項があれば入力してください"
                  />
                </div>
              </div>
            </div>
          </div>

          {/* 出店者募集期間 */}
          <div style={{ marginTop: '24px' }}>
            <h2 style={{
              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
              fontSize: '18px',
              fontStyle: 'normal',
              fontWeight: 700,
              lineHeight: '120%',
              color: '#2C3E50',
              marginBottom: '20px'
            }}>出店者募集期間（任意）</h2>
            <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
              <div style={{ width: '100%', position: 'relative' }}>
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>出店者募集期間（任意）</label>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  gap: '12px',
                  width: '100%',
                  padding: '0 16px',
                  height: '44px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px',
                  boxSizing: 'border-box'
                }}>
                  <input
                    type="date"
                    value={formData.application_start_date}
                    onChange={(e) => {
                      const newStartDate = e.target.value
                      const newDisplayPeriod = newStartDate && formData.application_end_date
                        ? formatDateRangeToJapanese(newStartDate, formData.application_end_date)
                        : formData.application_display_period
                      setFormData({ 
                        ...formData, 
                        application_start_date: newStartDate,
                        application_display_period: newDisplayPeriod
                      })
                    }}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.application_start_date ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      flex: 1,
                      background: 'transparent'
                    }}
                  />
                  <span style={{
                    fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                    fontSize: '16px',
                    fontWeight: 700,
                    color: '#666666'
                  }}>〜</span>
                  <input
                    type="date"
                    value={formData.application_end_date}
                    onChange={(e) => {
                      const newEndDate = e.target.value
                      const newDisplayPeriod = formData.application_start_date && newEndDate
                        ? formatDateRangeToJapanese(formData.application_start_date, newEndDate)
                        : formData.application_display_period
                      setFormData({ 
                        ...formData, 
                        application_end_date: newEndDate,
                        application_display_period: newDisplayPeriod
                      })
                    }}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.application_end_date ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      flex: 1,
                      background: 'transparent'
                    }}
                  />
                </div>
              </div>

              <div style={{ width: '100%', position: 'relative' }}>
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>出店者募集期間(表示用)（任意）</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  height: '44px',
                  padding: '0 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px',
                  display: 'flex',
                  alignItems: 'center'
                }}>
                  <input
                    type="text"
                    value={formData.application_display_period}
                    onChange={(e) => setFormData({ ...formData, application_display_period: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.application_display_period ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent'
                    }}
                    placeholder="自動生成されます（手動編集も可能）"
                  />
                </div>
              </div>

              <div style={{ width: '100%', position: 'relative' }}>
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>出店者募集に関する補足（任意）</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  minHeight: '96px',
                  padding: '12px 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px'
                }}>
                  <textarea
                    value={formData.application_notes}
                    onChange={(e) => setFormData({ ...formData, application_notes: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.application_notes ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent',
                      resize: 'none',
                      minHeight: '72px'
                    }}
                    placeholder="補足事項があれば入力してください"
                  />
                </div>
              </div>
            </div>
          </div>

          {/* イベント内容 */}
          <div style={{ marginTop: '24px' }}>
            <h2 style={{
              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
              fontSize: '18px',
              fontStyle: 'normal',
              fontWeight: 700,
              lineHeight: '120%',
              color: '#2C3E50',
              marginBottom: '20px'
            }}>イベント内容</h2>
            <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
              <div style={{ width: '100%', position: 'relative' }} data-error-field="lead_text">
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>リード文</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  minHeight: '120px',
                  padding: '12px 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px'
                }}>
                  <textarea
                    id="field-lead_text"
                    required
                    maxLength={100}
                    value={formData.lead_text}
                    onChange={(e) => setFormData({ ...formData, lead_text: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.lead_text ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent',
                      resize: 'none',
                      minHeight: '96px'
                    }}
                  />
                </div>
              </div>

              <div style={{ width: '100%', position: 'relative' }} data-error-field="event_description">
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>イベント紹介文</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  minHeight: '140px',
                  padding: '12px 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px'
                }}>
                  <textarea
                    id="field-event_description"
                    required
                    maxLength={250}
                    value={formData.event_description}
                    onChange={(e) => setFormData({ ...formData, event_description: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.event_description ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent',
                      resize: 'none',
                      minHeight: '120px'
                    }}
                  />
                </div>
              </div>

              <div style={{ width: '100%', position: 'relative' }}>
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>イベント紹介文（長文）（任意）</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  minHeight: '140px',
                  padding: '12px 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px'
                }}>
                  <textarea
                    value={formData.event_introduction_text}
                    onChange={(e) => setFormData({ ...formData, event_introduction_text: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.event_introduction_text ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent',
                      resize: 'none',
                      minHeight: '120px'
                    }}
                    placeholder="イベントの詳細を入力してください"
                  />
                </div>
              </div>
            </div>
          </div>

          {/* イベント画像 */}
          <div style={{ marginTop: '24px' }}>
            <h2 style={{
              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
              fontSize: '18px',
              fontStyle: 'normal',
              fontWeight: 700,
              lineHeight: '120%',
              color: '#2C3E50',
              marginBottom: '20px'
            }}>イベント画像（任意）</h2>
            <div style={{ display: 'flex', flexDirection: 'column', gap: '24px', alignItems: 'center' }}>
              <ImageUpload
                label="メイン画像（任意）"
                eventId={eventId || 'temp'}
                imageType="main"
                onUploadComplete={(url) => setImageUrls(prev => ({ ...prev, main: url }))}
                onUploadError={(error) => alert(error)}
                currentImageUrl={imageUrls.main}
                showFormatNote={false}
                onImageDelete={() => setImageUrls(prev => ({ ...prev, main: '' }))}
              />
              <ImageUpload
                label="追加画像1（任意）"
                eventId={eventId || 'temp'}
                imageType="additional"
                imageIndex={1}
                onUploadComplete={(url) => setImageUrls(prev => ({ ...prev, additional1: url }))}
                onUploadError={(error) => alert(error)}
                currentImageUrl={imageUrls.additional1}
                showFormatNote={false}
                onImageDelete={() => setImageUrls(prev => ({ ...prev, additional1: '' }))}
              />
              <ImageUpload
                label="追加画像2（任意）"
                eventId={eventId || 'temp'}
                imageType="additional"
                imageIndex={2}
                onUploadComplete={(url) => setImageUrls(prev => ({ ...prev, additional2: url }))}
                onUploadError={(error) => alert(error)}
                currentImageUrl={imageUrls.additional2}
                showFormatNote={false}
                onImageDelete={() => setImageUrls(prev => ({ ...prev, additional2: '' }))}
              />
              <ImageUpload
                label="追加画像3（任意）"
                eventId={eventId || 'temp'}
                imageType="additional"
                imageIndex={3}
                onUploadComplete={(url) => setImageUrls(prev => ({ ...prev, additional3: url }))}
                onUploadError={(error) => alert(error)}
                currentImageUrl={imageUrls.additional3}
                showFormatNote={false}
                onImageDelete={() => setImageUrls(prev => ({ ...prev, additional3: '' }))}
              />
              <ImageUpload
                label="追加画像4（任意）"
                eventId={eventId || 'temp'}
                imageType="additional"
                imageIndex={4}
                onUploadComplete={(url) => setImageUrls(prev => ({ ...prev, additional4: url }))}
                onUploadError={(error) => alert(error)}
                currentImageUrl={imageUrls.additional4}
                showFormatNote={false}
                onImageDelete={() => setImageUrls(prev => ({ ...prev, additional4: '' }))}
              />
            </div>
            <p style={{
              fontFamily: 'Inter, sans-serif',
              fontSize: '12px',
              lineHeight: '150%',
              color: '#6B6B6B',
              marginTop: '16px',
              textAlign: 'center'
            }}>
              対応形式: JPG, PNG, GIF, WebP（最大10MB）
            </p>
          </div>

          {/* 会場情報 */}
          <div style={{ marginTop: '24px' }}>
            <h2 style={{
              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
              fontSize: '18px',
              fontStyle: 'normal',
              fontWeight: 700,
              lineHeight: '120%',
              color: '#2C3E50',
              marginBottom: '20px'
            }}>会場情報</h2>
            <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
              <div style={{ width: '100%', position: 'relative' }} data-error-field="venue_name">
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>会場又は集合場所の名称</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  height: '44px',
                  padding: '0 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px',
                  display: 'flex',
                  alignItems: 'center'
                }}>
                  <input
                    id="field-venue_name"
                    type="text"
                    required
                    value={formData.venue_name}
                    onChange={(e) => setFormData({ ...formData, venue_name: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.venue_name ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent'
                    }}
                  />
                </div>
              </div>

              <div style={{ width: '100%', position: 'relative' }}>
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>郵便番号（任意）</label>
                <div style={{ display: 'flex', gap: '12px', width: '100%' }}>
                  <div style={{
                    boxSizing: 'border-box',
                    flex: 1,
                    height: '44px',
                    padding: '0 16px',
                    background: '#FFFFFF',
                    border: '1px solid #E9ECEF',
                    borderRadius: '8px',
                    display: 'flex',
                    alignItems: 'center'
                  }}>
                    <input
                      id="field-venue_postal_code"
                      type="text"
                      value={formData.venue_postal_code}
                      onChange={(e) => setFormData({ ...formData, venue_postal_code: e.target.value })}
                      style={{
                        fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                        fontSize: '15px',
                        lineHeight: '150%',
                        color: formData.venue_postal_code ? '#2C3E50' : '#6C757D',
                        border: 'none',
                        outline: 'none',
                        width: '100%',
                        background: 'transparent'
                      }}
                      placeholder="1234567"
                      maxLength={7}
                    />
                  </div>
                  <button
                    type="button"
                    onClick={() => fetchAddressFromPostalCode(formData.venue_postal_code)}
                    disabled={addressLoading || formData.venue_postal_code.length !== 7}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '14px',
                      fontWeight: 700,
                      lineHeight: '17px',
                      color: '#FFFFFF',
                      background: addressLoading || formData.venue_postal_code.length !== 7 ? '#D9D9D9' : '#FF8A5C',
                      border: 'none',
                      borderRadius: '8px',
                      padding: '12px 16px',
                      cursor: addressLoading || formData.venue_postal_code.length !== 7 ? 'not-allowed' : 'pointer',
                      height: '44px'
                    }}
                  >
                    {addressLoading ? '取得中...' : '住所取得'}
                  </button>
                </div>
              </div>

              <div style={{ width: '100%', position: 'relative' }}>
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>都道府県（任意）</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  height: '44px',
                  padding: '0 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px',
                  display: 'flex',
                  alignItems: 'center',
                  position: 'relative'
                }}>
                  <select
                    value={formData.venue_city}
                    onChange={(e) => setFormData({ ...formData, venue_city: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.venue_city ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent',
                      appearance: 'none',
                      cursor: 'pointer',
                      paddingRight: '30px'
                    }}
                  >
                    <option value="">選択してください</option>
                    {prefectures.map((prefecture) => (
                      <option key={prefecture} value={prefecture}>{prefecture}</option>
                    ))}
                  </select>
                  <svg
                    width="8"
                    height="5"
                    viewBox="0 0 8 5"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    style={{
                      position: 'absolute',
                      right: '16px',
                      top: '50%',
                      transform: 'translateY(-50%)',
                      pointerEvents: 'none'
                    }}
                  >
                    <path d="M4 5L0 0H8L4 5Z" fill="#6C757D"/>
                  </svg>
                </div>
              </div>

              <div style={{ width: '100%', position: 'relative' }}>
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>市区町村（任意）</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  height: '44px',
                  padding: '0 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px',
                  display: 'flex',
                  alignItems: 'center'
                }}>
                  <input
                    type="text"
                    value={formData.venue_town}
                    onChange={(e) => setFormData({ ...formData, venue_town: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.venue_town ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent'
                    }}
                  />
                </div>
              </div>

              <div style={{ width: '100%', position: 'relative' }}>
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>丁目番地号（任意）</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  height: '44px',
                  padding: '0 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px',
                  display: 'flex',
                  alignItems: 'center'
                }}>
                  <input
                    type="text"
                    value={formData.venue_address}
                    onChange={(e) => setFormData({ ...formData, venue_address: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.venue_address ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent'
                    }}
                  />
                </div>
              </div>

              <div style={{ width: '100%', position: 'relative' }}>
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>緯度（任意）</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  height: '44px',
                  padding: '0 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px',
                  display: 'flex',
                  alignItems: 'center'
                }}>
                  <input
                    type="text"
                    value={formData.venue_latitude}
                    onChange={(e) => setFormData({ ...formData, venue_latitude: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.venue_latitude ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent'
                    }}
                    placeholder="34.975 など"
                  />
                </div>
              </div>

              <div style={{ width: '100%', position: 'relative' }}>
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>経度（任意）</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  height: '44px',
                  padding: '0 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px',
                  display: 'flex',
                  alignItems: 'center'
                }}>
                  <input
                    type="text"
                    value={formData.venue_longitude}
                    onChange={(e) => setFormData({ ...formData, venue_longitude: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.venue_longitude ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent'
                    }}
                    placeholder="138.390 など"
                  />
                </div>
              </div>
            </div>
          </div>

          {/* URL情報 */}
          <div style={{ marginTop: '24px' }}>
            <h2 style={{
              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
              fontSize: '18px',
              fontStyle: 'normal',
              fontWeight: 700,
              lineHeight: '120%',
              color: '#2C3E50',
              marginBottom: '20px'
            }}>URL情報（任意）</h2>
            <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
              <div style={{ width: '100%', position: 'relative' }}>
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>公式サイトURL（任意）</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  height: '44px',
                  padding: '0 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px',
                  display: 'flex',
                  alignItems: 'center'
                }}>
                  <input
                    type="text"
                    value={formData.homepage_url}
                    onChange={(e) => setFormData({ ...formData, homepage_url: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.homepage_url ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent'
                    }}
                    placeholder="https://"
                  />
                </div>
              </div>

              <div style={{ width: '100%', position: 'relative' }}>
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>関連ページURL（任意）</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  height: '44px',
                  padding: '0 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px',
                  display: 'flex',
                  alignItems: 'center'
                }}>
                  <input
                    type="text"
                    value={formData.related_page_url}
                    onChange={(e) => setFormData({ ...formData, related_page_url: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.related_page_url ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent'
                    }}
                    placeholder="https://"
                  />
                </div>
              </div>
            </div>
          </div>

          {/* 連絡先情報 */}
          <div style={{ marginTop: '24px' }}>
            <h2 style={{
              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
              fontSize: '18px',
              fontStyle: 'normal',
              fontWeight: 700,
              lineHeight: '120%',
              color: '#2C3E50',
              marginBottom: '20px'
            }}>連絡先情報</h2>
            <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
              <div style={{ width: '100%', position: 'relative' }} data-error-field="contact_name">
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>問い合わせ先名称</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  height: '44px',
                  padding: '0 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px',
                  display: 'flex',
                  alignItems: 'center'
                }}>
                  <input
                    id="field-contact_name"
                    type="text"
                    required
                    value={formData.contact_name}
                    onChange={(e) => setFormData({ ...formData, contact_name: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.contact_name ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent'
                    }}
                  />
                </div>
              </div>

              <div style={{ width: '100%', position: 'relative' }} data-error-field="contact_phone">
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>電話番号</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  height: '44px',
                  padding: '0 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px',
                  display: 'flex',
                  alignItems: 'center'
                }}>
                  <input
                    id="field-contact_phone"
                    type="tel"
                    required
                    value={formData.contact_phone}
                    onChange={(e) => setFormData({ ...formData, contact_phone: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.contact_phone ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent'
                    }}
                  />
                </div>
              </div>

              <div style={{ width: '100%', position: 'relative' }}>
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>メールアドレス（任意）</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  height: '44px',
                  padding: '0 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px',
                  display: 'flex',
                  alignItems: 'center'
                }}>
                  <input
                    type="email"
                    value={formData.contact_email}
                    onChange={(e) => setFormData({ ...formData, contact_email: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.contact_email ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent'
                    }}
                  />
                </div>
              </div>
            </div>
          </div>

          {/* その他情報 */}
          <div style={{ marginTop: '24px' }}>
            <h2 style={{
              fontFamily: '"Inter", "Noto Sans JP", sans-serif',
              fontSize: '18px',
              fontStyle: 'normal',
              fontWeight: 700,
              lineHeight: '120%',
              color: '#2C3E50',
              marginBottom: '20px'
            }}>その他情報（任意）</h2>
            <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
              <div style={{ width: '100%', position: 'relative' }}>
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>駐車場情報（任意）</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  minHeight: '96px',
                  padding: '12px 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px'
                }}>
                  <textarea
                    value={formData.parking_info}
                    onChange={(e) => setFormData({ ...formData, parking_info: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.parking_info ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent',
                      resize: 'none',
                      minHeight: '72px'
                    }}
                    placeholder="駐車場に関する情報を入力してください"
                  />
                </div>
              </div>

              <div style={{ width: '100%', position: 'relative' }}>
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>料金情報（任意）</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  minHeight: '96px',
                  padding: '12px 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px'
                }}>
                  <textarea
                    value={formData.fee_info}
                    onChange={(e) => setFormData({ ...formData, fee_info: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.fee_info ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent',
                      resize: 'none',
                      minHeight: '72px'
                    }}
                    placeholder="料金に関する情報を入力してください"
                  />
                </div>
              </div>

              <div style={{ width: '100%', position: 'relative' }}>
                <label style={{
                  fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                  fontSize: '14px',
                  fontStyle: 'normal',
                  fontWeight: 700,
                  lineHeight: '1.4',
                  color: '#2C3E50',
                  marginBottom: '8px',
                  display: 'block'
                }}>主催者情報（任意）</label>
                <div style={{
                  boxSizing: 'border-box',
                  width: '100%',
                  minHeight: '96px',
                  padding: '12px 16px',
                  background: '#FFFFFF',
                  border: '1px solid #E9ECEF',
                  borderRadius: '8px'
                }}>
                  <textarea
                    value={formData.organizer_info}
                    onChange={(e) => setFormData({ ...formData, organizer_info: e.target.value })}
                    style={{
                      fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                      fontSize: '15px',
                      lineHeight: '150%',
                      color: formData.organizer_info ? '#2C3E50' : '#6C757D',
                      border: 'none',
                      outline: 'none',
                      width: '100%',
                      background: 'transparent',
                      resize: 'none',
                      minHeight: '72px'
                    }}
                    placeholder="主催者に関する情報を入力してください"
                  />
                </div>
              </div>
            </div>
          </div>
          </div>

          {/* 次へ進むボタン */}
          <div style={{ display: 'flex', justifyContent: 'center', marginTop: '24px' }}>
            <button
              type="submit"
              disabled={loading}
              style={{
                display: 'flex',
                flexDirection: 'row',
                justifyContent: 'center',
                alignItems: 'center',
                padding: '0',
                gap: '8px',
                width: '100%',
                maxWidth: '289px',
                height: '52px',
                background: loading ? '#9ca3af' : '#FF8A5C',
                borderRadius: '12px',
                border: 'none',
                fontFamily: '"Inter", "Noto Sans JP", sans-serif',
                fontSize: '15px',
                fontStyle: 'normal',
                fontWeight: 700,
                lineHeight: '52px',
                color: '#FFFFFF',
                cursor: loading ? 'not-allowed' : 'pointer',
                marginLeft: 'auto',
                marginRight: 'auto',
                transition: 'all 0.2s ease-in-out',
                boxShadow: loading ? 'none' : '0px 2px 8px rgba(0, 0, 0, 0.08)'
              }}
            >
              {loading ? (eventId ? '更新中...' : '作成中...') : '次へ進む'}
              {!loading && (
                <svg style={{ width: '10px', height: '10px', marginTop: '-2px' }} viewBox="0 0 5 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M0 0L5 5L0 10" stroke="white" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
                </svg>
              )}
            </button>
          </div>
        </form>
        </div>
      </div>
    </div>
  )
}
