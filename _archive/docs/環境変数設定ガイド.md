# 環境変数設定ガイド

このドキュメントでは、プロジェクトで使用するすべての環境変数の設定方法を説明します。

## 目次

1. [Vercelでの環境変数設定](#vercelでの環境変数設定)
2. [ローカル開発環境での設定](#ローカル開発環境での設定)
3. [環境変数一覧](#環境変数一覧)
4. [機能別の環境変数](#機能別の環境変数)
5. [設定後の手順](#設定後の手順)
6. [トラブルシューティング](#トラブルシューティング)

---

## Vercelでの環境変数設定

### 基本手順

1. [Vercel Dashboard](https://vercel.com/dashboard) にアクセス
2. プロジェクトを選択
3. 「Settings」タブ → 「Environment Variables」を選択
4. 「Add New」をクリック
5. 環境変数を追加（Key、Value、Environmentを設定）
6. 「Save」をクリック
7. **再デプロイを実行**（重要）

### プロジェクト別の設定

#### store-web / store-liff（出店者アプリ）

**必須環境変数:**
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `NEXT_PUBLIC_LINE_LOGIN_CHANNEL_ID`（LIFF版のみ）
- `LINE_LOGIN_CHANNEL_SECRET`（LIFF版のみ）
- `NEXT_PUBLIC_LINE_LOGIN_REDIRECT_URI`（LIFF版のみ）
- `NEXT_PUBLIC_APP_URL`

#### organizer-web（主催者アプリ）

**必須環境変数:**
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `NEXT_PUBLIC_APP_URL`

---

## ローカル開発環境での設定

### store/.env.local

```env
# Supabase設定
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key

# LINE Login設定（LIFF版のみ）
NEXT_PUBLIC_LINE_LOGIN_CHANNEL_ID=your_line_login_channel_id
LINE_LOGIN_CHANNEL_SECRET=your_line_login_channel_secret
NEXT_PUBLIC_LINE_LOGIN_REDIRECT_URI=http://localhost:3000/auth/callback

# ローカル開発用
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

### organizer/.env.local

```env
# Supabase設定
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key

# ローカル開発用
NEXT_PUBLIC_APP_URL=http://localhost:3001

# OpenAI API設定（営業許可証AI読み取り機能用）
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

---

## 環境変数一覧

### 基本設定

| 環境変数 | 説明 | 必須 | プロジェクト |
|---------|------|------|------------|
| `NEXT_PUBLIC_SUPABASE_URL` | SupabaseプロジェクトURL | ✅ | すべて |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Supabase匿名キー | ✅ | すべて |
| `NEXT_PUBLIC_APP_URL` | アプリのベースURL | ✅ | すべて |

### LINE Login（store-liffのみ）

| 環境変数 | 説明 | 必須 | プロジェクト |
|---------|------|------|------------|
| `NEXT_PUBLIC_LINE_LOGIN_CHANNEL_ID` | LINE Login Channel ID | ✅ | store-liff |
| `LINE_LOGIN_CHANNEL_SECRET` | LINE Login Channel Secret | ✅ | store-liff |
| `NEXT_PUBLIC_LINE_LOGIN_REDIRECT_URI` | LINE LoginコールバックURL | ✅ | store-liff |

---

## 機能別の環境変数

### 通知機能

| 環境変数 | 説明 | 必須 | プロジェクト |
|---------|------|------|------------|
| `SUPABASE_SERVICE_ROLE_KEY` | Supabaseサービスロールキー | ⚠️ | store, organizer |
| `RESEND_API_KEY` | Resend APIキー | ⚠️ | store, organizer |
| `RESEND_FROM_EMAIL` | 送信元メールアドレス | ⚠️ | store, organizer |

### 営業許可証AI読み取り機能

| 環境変数 | 説明 | 必須 | プロジェクト |
|---------|------|------|------------|
| `OPENAI_API_KEY` | OpenAI APIキー | ⚠️ | store, organizer |

**取得方法:**
1. [OpenAI Platform](https://platform.openai.com/) にアクセス
2. 「API keys」→「Create new secret key」
3. 生成されたキーをコピー（一度しか表示されないため注意）

---

## 設定後の手順

### 1. 再デプロイの実行

環境変数を追加・変更した後は、**必ず再デプロイが必要**です。

1. Vercel Dashboard → 「Deployments」タブ
2. 最新のデプロイメントの「...」メニュー → 「Redeploy」
3. 「Use existing Build Cache」のチェックを**外す**（重要）
4. 「Redeploy」をクリック

### 2. 動作確認

- アプリが正常に起動するか確認
- 各機能が正常に動作するか確認

---

## トラブルシューティング

### 環境変数が反映されない

- 再デプロイが完了しているか確認
- 「Use existing Build Cache」のチェックを外して再デプロイ
- 環境変数のKeyとValueが正しいか確認

### OpenAI API関連のエラー

- `OPENAI_API_KEY` が正しく設定されているか確認
- APIキーに余分なスペースや改行が含まれていないか確認
- [OpenAI Platform](https://platform.openai.com/account/billing) でAPIキーが有効か確認

### LINE Login関連のエラー

- `NEXT_PUBLIC_LINE_LOGIN_CHANNEL_ID` と `LINE_LOGIN_CHANNEL_SECRET` が正しいか確認
- LINE Developers ConsoleのCallback URLが正しく設定されているか確認

---

## 注意事項

- `NEXT_PUBLIC_` プレフィックスが付いている環境変数は、クライアントサイドでも使用可能
- `NEXT_PUBLIC_` プレフィックスが**ない**環境変数は、サーバーサイドのみで使用
- 環境変数は `.gitignore` に含まれているため、Gitにはコミットされません
- 環境変数を変更した場合は、開発サーバーを再起動してください
