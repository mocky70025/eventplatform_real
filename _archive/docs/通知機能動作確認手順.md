# 通知機能・パスワードリセット機能 動作確認手順

## 前提条件

- Supabaseで`notifications`テーブルを作成済み（`supabase_notifications_table.sql`を実行）
- store-web: LINEとメールアドレスでログイン済み
- organizer-web: メールアドレスでログイン済み

---

## 1. パスワードリセット機能の確認

### 1-1. 出店者アプリ（store-web）

1. ログアウト（プロフィールページから）
2. 「ログイン」→「メールアドレスでログイン」を選択
3. 「パスワードを忘れた場合」リンクをクリック
4. 登録済みのメールアドレスを入力
5. 「リセット用メールを送信」ボタンをクリック
6. ✅ 「パスワードリセット用のメールを送信しました」と表示されることを確認

### 1-2. 主催者アプリ（organizer-web）

1. ログアウト（プロフィールページから）
2. 「ログイン」→「メールアドレスでログイン」を選択
3. 「パスワードを忘れた場合」リンクをクリック
4. 登録済みのメールアドレスを入力
5. 「リセット用メールを送信」ボタンをクリック
6. ✅ 「パスワードリセット用のメールを送信しました」と表示されることを確認

**注意**: メール通知の環境変数が設定されていない場合、メールは送信されませんが、エラーは発生しません。

---

## 2. 通知機能の確認（申し込み時）

### 2-1. 出店者アプリでイベントに申し込む

1. store-webにログイン（LINEまたはメール）
2. イベント一覧から任意のイベントを選択
3. 「このイベントに申し込む」ボタンをクリック
4. ✅ 「申し込みが完了しました！」と表示されることを確認

### 2-2. 主催者アプリで通知を確認

1. organizer-webにログイン
2. ナビゲーションバーの「通知」タブを確認
3. ✅ 通知アイコンに未読バッジ（赤い丸）が表示されることを確認
4. 「通知」タブをクリック
5. ✅ 「新しい出店申し込み」という通知が表示されることを確認
6. ✅ 通知をクリックして既読になることを確認
7. ✅ 未読バッジが消えることを確認

---

## 3. 通知機能の確認（承認時）

### 3-1. 主催者アプリで申し込みを承認

1. organizer-webにログイン
2. イベント一覧から、申し込みがあったイベントを選択
3. 「申し込みを確認」ボタンをクリック
4. 申し込み一覧で「承認」ボタンをクリック
5. ✅ 「申し込みを承認しました」と表示されることを確認

### 3-2. 出店者アプリで通知を確認

1. store-webにログイン（申し込みをしたアカウント）
2. ナビゲーションバーの「通知」タブを確認
3. ✅ 通知アイコンに未読バッジ（赤い丸）が表示されることを確認
4. 「通知」タブをクリック
5. ✅ 「出店申し込みが承認されました」という通知が表示されることを確認
6. ✅ 通知をクリックして既読になることを確認
7. ✅ 未読バッジが消えることを確認

---

## 4. 通知機能の確認（却下時）

### 4-1. 主催者アプリで申し込みを却下

1. organizer-webにログイン
2. イベント一覧から、申し込みがあったイベントを選択
3. 「申し込みを確認」ボタンをクリック
4. 申し込み一覧で「却下」ボタンをクリック
5. ✅ 「申し込みを却下しました」と表示されることを確認

### 4-2. 出店者アプリで通知を確認

1. store-webにログイン（申し込みをしたアカウント）
2. ナビゲーションバーの「通知」タブを確認
3. ✅ 通知アイコンに未読バッジ（赤い丸）が表示されることを確認
4. 「通知」タブをクリック
5. ✅ 「出店申し込みが却下されました」という通知が表示されることを確認

---

## 5. 通知機能の詳細確認

### 5-1. 通知一覧の表示

1. 通知タブを開く
2. ✅ 通知が時系列順（新しい順）に表示されることを確認
3. ✅ 未読通知は背景色が異なることを確認
4. ✅ 未読通知には緑の丸が表示されることを確認
5. ✅ イベント名が表示されることを確認
6. ✅ 通知の日時が表示されることを確認

### 5-2. 一括既読機能

1. 通知タブを開く
2. 未読通知がある場合、「すべて既読」ボタンが表示されることを確認
3. 「すべて既読」ボタンをクリック
4. ✅ すべての通知が既読になることを確認
5. ✅ 未読バッジが消えることを確認

---

## 6. エラーケースの確認

### 6-1. 通知テーブルが存在しない場合

1. Supabaseで`notifications`テーブルを削除
2. イベントに申し込む
3. ✅ 申し込みは成功するが、通知の作成は失敗する（エラーは表示されない）

### 6-2. 環境変数が設定されていない場合

1. `SUPABASE_SERVICE_ROLE_KEY`が設定されていない場合
2. 通知の作成に失敗するが、申し込み自体は成功する

---

## 確認チェックリスト

- [ ] パスワードリセット機能（出店者）
- [ ] パスワードリセット機能（主催者）
- [ ] 申し込み時の通知（主催者への通知）
- [ ] 承認時の通知（出店者への通知）
- [ ] 却下時の通知（出店者への通知）
- [ ] 通知一覧の表示
- [ ] 未読バッジの表示
- [ ] 個別既読機能
- [ ] 一括既読機能
- [ ] 通知の日時表示

---

## トラブルシューティング

### 通知が表示されない場合

1. Supabaseで`notifications`テーブルが作成されているか確認
2. ブラウザのコンソールでエラーを確認
3. ネットワークタブでAPIリクエストが成功しているか確認

### 未読バッジが表示されない場合

1. 通知が実際に未読か確認（`is_read = false`）
2. ブラウザのコンソールでエラーを確認
3. 30秒待って自動更新されるか確認

### パスワードリセットメールが届かない場合

1. `RESEND_API_KEY`と`RESEND_FROM_EMAIL`が設定されているか確認
2. メールアドレスが正しいか確認
3. スパムフォルダを確認

