# ログイン方法動作確認手順（初回登録まで）

## 確認対象

以下の全てのパターンについて動作確認を行います：

1. **出店者アプリ（store）**
   - LINE Login（新規登録）
   - LINE Login（既存ユーザー）
   - メールアドレス・パスワード（新規登録）
   - メールアドレス・パスワード（既存ユーザー）
   - メール確認（メール認証の場合）

2. **主催者アプリ（organizer）**
   - LINE Login（新規登録）
   - LINE Login（既存ユーザー）
   - メールアドレス・パスワード（新規登録）
   - メールアドレス・パスワード（既存ユーザー）
   - メール確認（メール認証の場合）

---

## 準備

### 1. テスト用アカウントの準備

#### LINE Login用
- LINE Developers Consoleでテストユーザーとして追加済みのLINEアカウント
- または、開発ステータスのチャネルを使用する場合は、開発者ロールを持つLINEアカウント

#### メールアドレス・パスワード用
- 実際にメールを受信できるメールアドレスを複数用意
  - 新規登録用：`test-exhibitor-new@example.com`、`test-organizer-new@example.com`
  - 既存ユーザー用：`test-exhibitor-existing@example.com`、`test-organizer-existing@example.com`

### 2. ブラウザの準備
- 通常モードとシークレットモード（プライベートモード）を使用
- 複数のブラウザ（Chrome、Safari、Firefox）で確認（推奨）

### 3. アプリケーションURL
- 出店者アプリ：`https://tomorrow-event-platform-store.vercel.app`
- 主催者アプリ：`https://tomorrow-event-platform-organizer.vercel.app`

### 4. データベースの準備（重要）

#### 各パターンの確認前にデータベースをクリーンな状態に戻す

**方法1: 全データを削除（テスト環境のみ）**
1. Supabase Dashboard > SQL Editor を開く
2. `テストデータ削除スクリプト.sql` の内容をコピー＆ペースト
3. 実行して、全てのテストデータを削除

**方法2: 条件付きで削除（本番データを保持）**
1. Supabase Dashboard > SQL Editor を開く
2. `テストデータ削除スクリプト（条件付き）.sql` の内容をコピー＆ペースト
3. 必要に応じて条件を調整（例：`test-%@example.com` の部分）
4. 実行して、テストデータのみを削除

**方法3: Supabase Authのユーザーも削除する場合**
1. Supabase Dashboard > Authentication > Users を開く
2. テスト用のメールアドレス（`test-%@example.com`）で検索
3. 該当するユーザーを手動で削除

**推奨手順：**
- 各パターンの確認前に、該当するテストデータを削除
- 特に「既存ユーザー」のテストを行う前に、そのユーザーのデータが存在することを確認
- 「新規登録」のテストを行う前に、そのメールアドレスやLINEアカウントのデータが存在しないことを確認

---

## 出店者アプリ（store）の動作確認

### パターン1: LINE Login（新規登録）

#### 事前準備
- ✅ データベースから該当するLINEアカウントのデータを削除（既に登録済みの場合）
- ✅ Supabase Dashboard > Authentication > Users で該当するLINEユーザーを削除（必要に応じて）

#### 手順
1. **アプリにアクセス**
   - `https://tomorrow-event-platform-store.vercel.app` を開く

2. **初期画面の確認**
   - ✅ 「新規登録」と「ログイン」のボタンが表示される
   - ✅ 「新規登録」をクリック

3. **認証方法選択**
   - ✅ 「LINEで新規登録」と「メールアドレスで新規登録」のボタンが表示される
   - ✅ 「LINEで新規登録」をクリック

4. **LINE Login**
   - ✅ LINE Loginの認証画面にリダイレクトされる
   - ✅ LINEアカウントでログイン
   - ✅ アプリに戻る（コールバック）

5. **登録フォーム表示**
   - ✅ 登録フォーム（3ステップ）が表示される
   - ✅ フォームに入力できる

6. **登録完了**
   - ✅ フォームを送信
   - ✅ 「登録が完了しました」画面が表示される
   - ✅ ホーム画面に戻る

#### 確認ポイント
- [ ] LINE Loginの認証フローが正常に動作する
- [ ] コールバック後、登録フォームが表示される
- [ ] 登録フォームに入力・送信できる
- [ ] 登録完了後、ホーム画面に戻る

---

### パターン2: LINE Login（既存ユーザー）

#### 事前準備
- ✅ パターン1で登録済みのLINEアカウントを使用
- ✅ または、既に登録済みのLINEアカウントを用意
- ✅ データベースに該当するLINEアカウントのデータが存在することを確認

#### 手順
1. **事前確認**
   - データベースに該当するLINEアカウントの出店者データが存在することを確認

2. **アプリにアクセス**
   - `https://tomorrow-event-platform-store.vercel.app` を開く

3. **ログイン**
   - ✅ 「ログイン」をクリック
   - ✅ 「LINEでログイン」をクリック
   - ✅ LINE Loginの認証画面でログイン

4. **ホーム画面表示**
   - ✅ 登録フォームではなく、ホーム画面（イベント一覧）が表示される
   - ✅ 登録情報が表示される（プロフィール画面）

#### 確認ポイント
- [ ] 既存ユーザーは登録フォームが表示されない
- [ ] ホーム画面（イベント一覧）が表示される
- [ ] 登録情報が正しく表示される

---

### パターン3: メールアドレス・パスワード（新規登録）

#### 事前準備
- ✅ データベースから該当するメールアドレス（`test-exhibitor-new@example.com`）のデータを削除
- ✅ Supabase Dashboard > Authentication > Users で該当するメールアドレスのユーザーを削除（存在する場合）

#### 手順
1. **アプリにアクセス**
   - `https://tomorrow-event-platform-store.vercel.app` を開く

2. **初期画面の確認**
   - ✅ 「新規登録」をクリック

3. **認証方法選択**
   - ✅ 「メールアドレスで新規登録」をクリック

4. **登録フォーム入力**
   - ✅ メールアドレスを入力（例：`test-exhibitor-new@example.com`）
   - ✅ パスワードを入力（6文字以上）
   - ✅ パスワード（確認）を入力
   - ✅ 「登録する」をクリック

5. **確認メール送信**
   - ✅ 「確認メールを送信しました」というメッセージが表示される
   - ✅ 初期画面に戻る

6. **メール確認（オプション）**
   - ✅ メールアドレスに確認メールが届く
   - ✅ メール内のリンクをクリック
   - ✅ メール確認ページにリダイレクトされる
   - ✅ 「メールアドレスの確認が完了しました」と表示される
   - ✅ ホーム画面に自動リダイレクトされる

7. **登録フォーム表示**
   - ✅ メール確認待ちでも登録フォームが表示される
   - ✅ フォームに入力できる
   - ✅ メール確認バナーが表示される（未確認の場合）

8. **登録完了**
   - ✅ フォームを送信
   - ✅ 「登録が完了しました」画面が表示される

#### 確認ポイント
- [ ] メールアドレス・パスワードで新規登録できる
- [ ] 確認メールが送信される
- [ ] メール確認待ちでも登録フォームに入力できる
- [ ] メール確認バナーが表示される（未確認の場合）
- [ ] メール確認リンクが正常に動作する
- [ ] 登録フォームに入力・送信できる

---

### パターン4: メールアドレス・パスワード（既存ユーザー）

#### 事前準備
- ✅ パターン3で登録済みのメールアドレス・パスワードを使用
- ✅ または、既に登録済みのアカウントを用意
- ✅ データベースに該当するメールアドレスの出店者データが存在することを確認
- ✅ Supabase Authに該当するメールアドレスのユーザーが存在することを確認

#### 手順
1. **事前確認**
   - データベースに該当するメールアドレスの出店者データが存在することを確認

2. **アプリにアクセス**
   - `https://tomorrow-event-platform-store.vercel.app` を開く

3. **ログイン**
   - ✅ 「ログイン」をクリック
   - ✅ 「メールアドレスでログイン」をクリック
   - ✅ メールアドレスとパスワードを入力
   - ✅ 「ログイン」をクリック

4. **ホーム画面表示**
   - ✅ 登録フォームではなく、ホーム画面（イベント一覧）が表示される
   - ✅ メール確認バナーが表示されない（確認済みの場合）

#### 確認ポイント
- [ ] 既存ユーザーは登録フォームが表示されない
- [ ] ホーム画面（イベント一覧）が表示される
- [ ] メール確認バナーが表示されない（確認済みの場合）

---

### パターン5: メール確認の動作確認

#### 手順
1. **メール未確認状態でのログイン**
   - メール確認待ちのアカウントでログイン
   - ✅ メール確認バナーが表示される

2. **確認メール再送信**
   - ✅ バナーの「確認メールを再送信」ボタンをクリック
   - ✅ 「送信しました」というメッセージが表示される
   - ✅ メールアドレスに確認メールが再送信される

3. **メール確認リンクのクリック**
   - ✅ メール内のリンクをクリック
   - ✅ メール確認ページにリダイレクトされる
   - ✅ 「メールアドレスの確認が完了しました」と表示される
   - ✅ ホーム画面に自動リダイレクトされる

4. **確認後の状態**
   - ✅ メール確認バナーが表示されない
   - ✅ 通常のログイン状態になる

#### 確認ポイント
- [ ] メール未確認状態でバナーが表示される
- [ ] 確認メール再送信が動作する
- [ ] メール確認リンクが正常に動作する
- [ ] 確認後、バナーが表示されない

---

## 主催者アプリ（organizer）の動作確認

### パターン6: LINE Login（新規登録）

#### 事前準備
- ✅ データベースから該当するLINEアカウントのデータを削除（既に登録済みの場合）
- ✅ Supabase Dashboard > Authentication > Users で該当するLINEユーザーを削除（必要に応じて）

#### 手順
1. **アプリにアクセス**
   - `https://tomorrow-event-platform-organizer.vercel.app` を開く

2. **初期画面の確認**
   - ✅ 「新規登録」と「ログイン」のボタンが表示される
   - ✅ 「新規登録」をクリック

3. **認証方法選択**
   - ✅ 「LINEで新規登録」と「メールアドレスで新規登録」のボタンが表示される
   - ✅ 「LINEで新規登録」をクリック

4. **LINE Login**
   - ✅ LINE Loginの認証画面にリダイレクトされる
   - ✅ LINEアカウントでログイン
   - ✅ アプリに戻る（コールバック）

5. **登録フォーム表示**
   - ✅ 登録フォームが表示される
   - ✅ フォームに入力できる

6. **登録完了**
   - ✅ フォームを送信
   - ✅ 「登録が完了しました」画面が表示される
   - ✅ ホーム画面に戻る

#### 確認ポイント
- [ ] LINE Loginの認証フローが正常に動作する
- [ ] コールバック後、登録フォームが表示される
- [ ] 登録フォームに入力・送信できる
- [ ] 登録完了後、ホーム画面に戻る

---

### パターン7: LINE Login（既存ユーザー）

#### 事前準備
- ✅ パターン6で登録済みのLINEアカウントを使用
- ✅ または、既に登録済みのLINEアカウントを用意
- ✅ データベースに該当するLINEアカウントの主催者データが存在することを確認

#### 手順
1. **事前確認**
   - データベースに該当するLINEアカウントの主催者データが存在することを確認

2. **アプリにアクセス**
   - `https://tomorrow-event-platform-organizer.vercel.app` を開く

3. **ログイン**
   - ✅ 「ログイン」をクリック
   - ✅ 「LINEでログイン」をクリック
   - ✅ LINE Loginの認証画面でログイン

4. **ホーム画面表示**
   - ✅ 登録フォームではなく、ホーム画面（イベント管理）が表示される
   - ✅ 登録情報が表示される（プロフィール画面）

#### 確認ポイント
- [ ] 既存ユーザーは登録フォームが表示されない
- [ ] ホーム画面（イベント管理）が表示される
- [ ] 登録情報が正しく表示される

---

### パターン8: メールアドレス・パスワード（新規登録）

#### 事前準備
- ✅ データベースから該当するメールアドレス（`test-organizer-new@example.com`）のデータを削除
- ✅ Supabase Dashboard > Authentication > Users で該当するメールアドレスのユーザーを削除（存在する場合）

#### 手順
1. **アプリにアクセス**
   - `https://tomorrow-event-platform-organizer.vercel.app` を開く

2. **初期画面の確認**
   - ✅ 「新規登録」をクリック

3. **認証方法選択**
   - ✅ 「メールアドレスで新規登録」をクリック

4. **登録フォーム入力**
   - ✅ メールアドレスを入力（例：`test-organizer-new@example.com`）
   - ✅ パスワードを入力（6文字以上）
   - ✅ パスワード（確認）を入力
   - ✅ 「登録する」をクリック

5. **確認メール送信**
   - ✅ 「確認メールを送信しました」というメッセージが表示される
   - ✅ 初期画面に戻る

6. **メール確認（オプション）**
   - ✅ メールアドレスに確認メールが届く
   - ✅ メール内のリンクをクリック
   - ✅ メール確認ページにリダイレクトされる
   - ✅ 「メールアドレスの確認が完了しました」と表示される
   - ✅ ホーム画面に自動リダイレクトされる

7. **登録フォーム表示**
   - ✅ メール確認待ちでも登録フォームが表示される
   - ✅ フォームに入力できる
   - ✅ メール確認バナーが表示される（未確認の場合）

8. **登録完了**
   - ✅ フォームを送信
   - ✅ 「登録が完了しました」画面が表示される

#### 確認ポイント
- [ ] メールアドレス・パスワードで新規登録できる
- [ ] 確認メールが送信される
- [ ] メール確認待ちでも登録フォームに入力できる
- [ ] メール確認バナーが表示される（未確認の場合）
- [ ] メール確認リンクが正常に動作する
- [ ] 登録フォームに入力・送信できる

---

### パターン9: メールアドレス・パスワード（既存ユーザー）

#### 事前準備
- ✅ パターン8で登録済みのメールアドレス・パスワードを使用
- ✅ または、既に登録済みのアカウントを用意
- ✅ データベースに該当するメールアドレスの主催者データが存在することを確認
- ✅ Supabase Authに該当するメールアドレスのユーザーが存在することを確認

#### 手順
1. **事前確認**
   - データベースに該当するメールアドレスの主催者データが存在することを確認

2. **アプリにアクセス**
   - `https://tomorrow-event-platform-organizer.vercel.app` を開く

3. **ログイン**
   - ✅ 「ログイン」をクリック
   - ✅ 「メールアドレスでログイン」をクリック
   - ✅ メールアドレスとパスワードを入力
   - ✅ 「ログイン」をクリック

4. **ホーム画面表示**
   - ✅ 登録フォームではなく、ホーム画面（イベント管理）が表示される
   - ✅ メール確認バナーが表示されない（確認済みの場合）

#### 確認ポイント
- [ ] 既存ユーザーは登録フォームが表示されない
- [ ] ホーム画面（イベント管理）が表示される
- [ ] メール確認バナーが表示されない（確認済みの場合）

---

### パターン10: メール確認の動作確認（主催者）

#### 手順
1. **メール未確認状態でのログイン**
   - メール確認待ちのアカウントでログイン
   - ✅ メール確認バナーが表示される

2. **確認メール再送信**
   - ✅ バナーの「確認メールを再送信」ボタンをクリック
   - ✅ 「送信しました」というメッセージが表示される
   - ✅ メールアドレスに確認メールが再送信される

3. **メール確認リンクのクリック**
   - ✅ メール内のリンクをクリック
   - ✅ メール確認ページにリダイレクトされる
   - ✅ 「メールアドレスの確認が完了しました」と表示される
   - ✅ ホーム画面に自動リダイレクトされる

4. **確認後の状態**
   - ✅ メール確認バナーが表示されない
   - ✅ 通常のログイン状態になる

#### 確認ポイント
- [ ] メール未確認状態でバナーが表示される
- [ ] 確認メール再送信が動作する
- [ ] メール確認リンクが正常に動作する
- [ ] 確認後、バナーが表示されない

---

## エラーケースの確認

### 1. パスワード不一致
- [ ] 新規登録時にパスワードとパスワード（確認）が一致しない場合、エラーメッセージが表示される

### 2. 既存メールアドレス
- [ ] 既に登録済みのメールアドレスで新規登録しようとした場合、エラーメッセージが表示される

### 3. 無効なメールアドレス形式
- [ ] 無効なメールアドレス形式を入力した場合、エラーメッセージが表示される

### 4. パスワードが短すぎる
- [ ] 6文字未満のパスワードを入力した場合、エラーメッセージが表示される

### 5. 間違ったパスワードでログイン
- [ ] 間違ったパスワードでログインしようとした場合、エラーメッセージが表示される

### 6. 存在しないメールアドレスでログイン
- [ ] 登録されていないメールアドレスでログインしようとした場合、エラーメッセージが表示される

---

## 動作確認チェックリスト

### 出店者アプリ（store）
- [ ] パターン1: LINE Login（新規登録）
- [ ] パターン2: LINE Login（既存ユーザー）
- [ ] パターン3: メールアドレス・パスワード（新規登録）
- [ ] パターン4: メールアドレス・パスワード（既存ユーザー）
- [ ] パターン5: メール確認の動作確認

### 主催者アプリ（organizer）
- [ ] パターン6: LINE Login（新規登録）
- [ ] パターン7: LINE Login（既存ユーザー）
- [ ] パターン8: メールアドレス・パスワード（新規登録）
- [ ] パターン9: メールアドレス・パスワード（既存ユーザー）
- [ ] パターン10: メール確認の動作確認

### エラーケース
- [ ] パスワード不一致
- [ ] 既存メールアドレス
- [ ] 無効なメールアドレス形式
- [ ] パスワードが短すぎる
- [ ] 間違ったパスワードでログイン
- [ ] 存在しないメールアドレスでログイン

---

## トラブルシューティング

### LINE Loginが動作しない場合
1. LINE Developers Consoleでチャネル設定を確認
2. コールバックURLが正しく設定されているか確認
3. テストユーザーが追加されているか確認（開発ステータスの場合）
4. ブラウザのコンソールでエラーメッセージを確認

### メール確認メールが届かない場合
1. スパムフォルダを確認
2. Supabase Dashboardでメール送信設定を確認
3. メールアドレスが正しく入力されているか確認
4. 開発環境ではメール送信が制限される場合がある

### 登録フォームが表示されない場合
1. ブラウザのコンソールでエラーメッセージを確認
2. セッションストレージに`user_id`が保存されているか確認
3. ネットワークタブでAPIリクエストを確認

---

## 完了条件

全てのパターンについて以下が確認できれば完了です：

1. ✅ 新規登録が正常に完了する
2. ✅ 既存ユーザーのログインが正常に動作する
3. ✅ メール確認が正常に動作する
4. ✅ エラーケースで適切なエラーメッセージが表示される
5. ✅ 登録フォームに入力・送信できる

