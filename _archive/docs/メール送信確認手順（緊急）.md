# メール送信確認手順（緊急対応）

## 即座に確認すべき項目

### 1. Supabase Dashboardでユーザーが作成されているか確認

1. **Supabase Dashboardにログイン**
   - https://supabase.com/dashboard にアクセス
   - プロジェクトを選択

2. **「Authentication」> 「Users」を開く**
   - 登録したメールアドレスでユーザーが作成されているか確認
   - ユーザーが存在する場合：
     - 「Email confirmed」が `false` になっているか確認
     - 「Created at」の時刻を確認（登録時刻と一致するか）
     - 「Last sign in」が `null` になっているか確認

3. **ユーザーが存在しない場合**
   - 登録処理自体が失敗している可能性があります
   - ブラウザのコンソールでエラーを確認してください

### 2. Supabase Authのメール送信設定を確認

1. **「Authentication」> 「Settings」を開く**

2. **「Email Auth」セクションを確認**
   - ✅ 「Enable email confirmations」が **ON** になっているか
   - ✅ 「Enable email signup」が **ON** になっているか

3. **「URL Configuration」セクションを確認**
   - ✅ 「Site URL」が正しく設定されているか
     - 例: `https://tomorrow-event-platform-organizer.vercel.app`
   - ✅ 「Redirect URLs」に以下が追加されているか：
     ```
     https://tomorrow-event-platform-organizer.vercel.app/auth/verify-email
     https://tomorrow-event-platform-organizer.vercel.app/**
     ```

### 3. ブラウザのコンソールでエラーを確認

1. **開発者ツールを開く**（F12）
2. **「Console」タブを開く**
3. **メールアドレス新規登録を実行**
4. **以下のログを確認**：
   - `[WelcomeScreen] Email registration - redirectUrl: ...`
   - `[WelcomeScreen] SignUp response: ...`
   - `[WelcomeScreen] User created successfully: ...`
   - **エラーメッセージがないか確認**

### 4. Supabaseのメール送信ログを確認

1. **Supabase Dashboard > 「Logs」> 「Auth Logs」を開く**
2. **最近のログを確認**
   - メール送信の試行が記録されているか
   - エラーが記録されていないか

### 5. メール送信のテスト

**Supabase Dashboardから直接メールを送信してテスト：**

1. **「Authentication」> 「Users」を開く**
2. **登録したユーザーを選択**
3. **「Send magic link」または「Resend confirmation email」をクリック**
4. **メールが届くか確認**

## よくある問題と解決方法

### 問題1: メール確認が無効になっている

**症状：**
- ユーザーは作成されるが、メールが送信されない
- `data.session` が存在する（メール確認が不要な状態）

**解決方法：**
1. Supabase Dashboard > 「Authentication」> 「Settings」を開く
2. 「Enable email confirmations」を **ON** にする
3. 「Save」をクリック
4. 再度新規登録を試す

### 問題2: リダイレクトURLが設定されていない

**症状：**
- ユーザーは作成されるが、メールが送信されない
- メール送信のログにエラーが記録されている

**解決方法：**
1. Supabase Dashboard > 「Authentication」> 「URL Configuration」を開く
2. 「Redirect URLs」に以下を追加：
   ```
   https://tomorrow-event-platform-organizer.vercel.app/auth/verify-email
   https://tomorrow-event-platform-organizer.vercel.app/**
   ```
3. 「Save」をクリック
4. 再度新規登録を試す

### 問題3: メール送信の制限に達している

**症状：**
- ユーザーは作成されるが、メールが送信されない
- メール送信のログに制限エラーが記録されている

**解決方法：**
1. Supabase Dashboard > 「Settings」> 「Usage」を開く
2. メール送信の使用状況を確認
3. 制限に達している場合は、時間をおいてから再度試す
4. または、カスタムSMTPサーバーを設定する（有料プラン）

### 問題4: 開発環境でのメール送信制限

**症状：**
- ローカル環境や開発環境でメールが送信されない

**解決方法：**
- 開発環境では、メール確認を無効にするか、カスタムSMTPサーバーを設定する
- 本番環境（Vercel）で確認する

### 問題5: メールアドレスの形式が正しくない

**症状：**
- 登録時にエラーが発生する

**解決方法：**
- メールアドレスの形式を確認
- 例: `test@example.com`（有効）、`test@`（無効）

## 緊急対応：メール確認を一時的に無効にする

**注意：** これは開発環境でのみ使用してください。

1. **Supabase Dashboard > 「Authentication」> 「Settings」を開く**
2. **「Enable email confirmations」を **OFF** にする**
3. **「Save」をクリック**
4. **再度新規登録を試す**
   - この場合、メール確認なしで登録できます
   - セッションが作成され、すぐに登録フォームに進めます

## 次のステップ

1. **上記の確認項目を全て実行**
2. **Supabase Dashboardでユーザーが作成されているか確認**
3. **メール送信設定を確認**
4. **ブラウザのコンソールでエラーを確認**
5. **それでも解決しない場合は、Supabaseのサポートに問い合わせる**

## デバッグ情報の収集

問題が解決しない場合、以下の情報を収集してください：

1. **ブラウザのコンソールログ**（全て）
2. **Supabase Dashboardのスクリーンショット**：
   - Authentication > Settings
   - Authentication > Users（登録したユーザー）
   - Logs > Auth Logs（最近のログ）
3. **登録時に使用したメールアドレス**
4. **登録時刻**

