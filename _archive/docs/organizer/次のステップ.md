# organizer側（主催者アプリ）開発環境セットアップ手順

## 概要

organizer側（主催者アプリ）を開発環境で動作させるためのセットアップ手順です。
store側と**同じLINEログインチャネルID**を使用することで、**確実に同じユーザーID**を取得できます。

## ✅ 完了したこと
- [x] データベースマイグレーション（`organizer_migration_to_line_login_simple.sql`を実行）
- [x] コード実装（LINE Login対応）

---

## 📋 開発環境セットアップ手順

### ステップ1: 環境変数の設定

`organizer/.env.local` ファイルを作成（または更新）して、以下を設定してください：

```env
# Supabase設定
NEXT_PUBLIC_SUPABASE_URL=https://wosgrdgnkdaxmykclazc.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indvc2dyZGdua2RheG15a2NsYXpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzMjU4OTksImV4cCI6MjA3ODkwMTg5OX0.tAB-e53Xf8Lif8yzpJCoXsmnKM_oTAiVEMbETo4ivSg

# LINE Login設定
NEXT_PUBLIC_LINE_LOGIN_CHANNEL_ID=2008516155
LINE_LOGIN_CHANNEL_SECRET=4b6ca4be9c0ae7e856bb4db72c777876
NEXT_PUBLIC_LINE_LOGIN_REDIRECT_URI=http://localhost:3002/auth/callback
NEXT_PUBLIC_APP_URL=http://localhost:3002
```

**⚠️ 重要**: 
- `NEXT_PUBLIC_LINE_LOGIN_REDIRECT_URI` は `http://localhost:3002/auth/callback` です（organizer側はポート3002）
- `NEXT_PUBLIC_APP_URL` も `http://localhost:3002` です
- store側とorganizer側で**同じLINEログインチャネルID**を使用してください

---

### ステップ2: LINE DevelopersでコールバックURLを追加

1. LINE Developers Consoleを開く
2. 使用しているLINEログインチャネルを選択
3. 「LINEログイン設定」タブを開く
4. 「コールバックURL」セクションで「追加」をクリック
5. 以下のURLを追加：
   ```
   http://localhost:3002/auth/callback
   ```
   （store側の `http://localhost:3001/auth/callback` とは別に追加）

**✅ 確認ポイント**: 
- store側とorganizer側で**同じLINEログインチャネル**を使用していることを確認
- コールバックURLが両方追加されていることを確認

---

### ステップ3: 開発サーバーを起動

```bash
cd organizer
npm run dev
```

サーバーが `http://localhost:3002` で起動することを確認してください。

**⚠️ 注意**: organizer側はポート3002で起動します（store側は3001）

---

### ステップ4: 動作確認

1. **ブラウザで `http://localhost:3002` を開く**
2. **開発者ツール（DevTools）を開く**（F12 または Cmd+Option+I）
3. **「Console」タブを選択**
4. **「LINEでログイン」ボタンをクリック**
5. **LINEログイン画面で認証**
6. **コールバック後、コンソールに以下のログが表示されることを確認**：
   ```
   [LINE Login] User ID: U1234567890abcdef...
   [LINE Login] Display Name: あなたの名前
   ```
7. **主催者登録フォームが表示されることを確認**

---

### ステップ5: 出店者と主催者で同じアカウントが使えるか確認

1. **出店者アプリ（store）でログイン**
   - `http://localhost:3001` を開く
   - LINEログインを実行
   - ユーザーIDをメモ

2. **主催者アプリ（organizer）でログイン**
   - `http://localhost:3002` を開く
   - LINEログインを実行
   - ユーザーIDをメモ

3. **ユーザーIDが一致することを確認**
   - ✅ 同じユーザーIDなら成功！
   - ❌ 異なる場合は、LINE Developersの設定を確認

---

## 🔍 トラブルシューティング

### エラー: `NEXT_PUBLIC_LINE_LOGIN_CHANNEL_ID is not set`
- `.env.local` に環境変数が正しく設定されているか確認
- サーバーを再起動してください

### エラー: `Failed to exchange code for token`
- `LINE_LOGIN_CHANNEL_SECRET` が正しく設定されているか確認
- コールバックURLが正しく設定されているか確認

### コールバック後にエラーが出る
- ブラウザのコンソールでエラー内容を確認
- データベースの`organizers`テーブルに`line_user_id`カラムが追加されているか確認

### ユーザーIDが一致しない場合
- store側とorganizer側で同じLINEログインチャネルIDを使用しているか確認
- 環境変数が正しく設定されているか確認
- LINE Developersの設定を再確認

---

## ✅ 完了チェックリスト

- [ ] `organizer/.env.local` に環境変数を設定
- [ ] LINE DevelopersでコールバックURLを追加（`http://localhost:3002/auth/callback`）
- [ ] 開発サーバーを起動（ポート3002）
- [ ] 主催者アプリでLINEログインが動作することを確認
- [ ] 出店者と主催者で同じユーザーIDが取得できることを確認

---

## 🎉 完了後

すべてのチェックが完了したら、出店者と主催者の両方でLINE Loginが動作し、同じLINEアカウントを使用できるようになります！

---

## 📚 関連ファイル

- `本番環境セットアップ手順.md` - 本番環境（Vercel）へのデプロイ手順
- `organizer/本番環境セットアップ手順.md` - organizer側の本番環境セットアップ手順
- `ngrokセットアップ手順.md` - 開発環境でHTTPSを使用する場合の手順（ngrok使用）


